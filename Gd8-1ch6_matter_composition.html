<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8‰∏äÁ¨¨6Á´† Êé¢Á¥¢Áâ©Ë≥™ÁµÑÊàê - ‰∫íÂãïÂºèÈóñÈóúÁ≥ªÁµ±</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- html2canvas for certificate -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * {
            font-family: 'Noto+Sans TC', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            overscroll-behavior: none;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .drag-item {
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .drop-zone {
            min-height: 120px;
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            transform: scale(1.02);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        .progress-bar {
            max-width: 50%;
        }
        
        @media (max-width: 768px) {
            .progress-bar {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===========================================
        // GAME DATA - ÊâÄÊúâÈóúÂç°Êï∏Êìö
        // ===========================================
        const CHAPTER_DATA = {
            "6-1": [
                {
                    id: "6-1-1",
                    section: "6-1",
                    title: "Á¨¨‰∏ÄÈóúÔºöÈáëÂ±¨ËàáÈùûÈáëÂ±¨ÂÖÉÁ¥†ÂàÜÈ°û",
                    description: "Ë´ãÂ∞á‰ª•‰∏ãÂÖÉÁ¥†‰æùÂÖ∂ÊÄßË≥™ÂàÜÈ°ûÂà∞ÈáëÂ±¨ÊàñÈùûÈáëÂ±¨",
                    type: "classification",
                    zones: [
                        { id: 'metal', title: 'ÈáëÂ±¨ÂÖÉÁ¥†', icon: 'fa-layer-group' },
                        { id: 'nonmetal', title: 'ÈùûÈáëÂ±¨ÂÖÉÁ¥†', icon: 'fa-cube' }
                    ],
                    items: [
                        { id: 'item1', text: 'Èêµ (Fe)', val: 'Fe' },
                        { id: 'item2', text: 'ÈäÖ (Cu)', val: 'Cu' },
                        { id: 'item3', text: 'Á°´ (S)', val: 'S' },
                        { id: 'item4', text: 'Á¢≥ (C)', val: 'C' },
                        { id: 'item5', text: 'ÈãÅ (Al)', val: 'Al' },
                        { id: 'item6', text: 'Ê∞Ø (Cl)', val: 'Cl' },
                        { id: 'item7', text: 'Èáë (Au)', val: 'Au' },
                        { id: 'item8', text: 'Ê∞ß (O)', val: 'O' },
                        { id: 'item9', text: 'ÈäÄ (Ag)', val: 'Ag' },
                        { id: 'item10', text: 'Ê∞Æ (N)', val: 'N' }
                    ],
                    solution: {
                        metal: ['Fe', 'Cu', 'Al', 'Au', 'Ag'],
                        nonmetal: ['S', 'C', 'Cl', 'O', 'N']
                    }
                },
                {
                    id: "6-1-2",
                    section: "6-1",
                    title: "Á¨¨‰∫åÈóúÔºöÈáëÂ±¨ËàáÈùûÈáëÂ±¨ÊÄßË≥™ÈÖçÂ∞ç",
                    description: "Ë´ãÂ∞á‰ª•‰∏ãÊÄßË≥™ËàáÈáëÂ±¨ÊàñÈùûÈáëÂ±¨ÂÖÉÁ¥†ÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'ÈáëÂ±¨ÂÖÉÁ¥†ÁöÑÁâπÊÄß', val: 'metal_properties' },
                        { id: 'left2', text: 'ÈùûÈáëÂ±¨ÂÖÉÁ¥†ÁöÑÁâπÊÄß', val: 'nonmetal_properties' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: 'ÂÖ∑ÊúâÈáëÂ±¨ÂÖâÊæ§', val: 'metal_luster' },
                        { id: 'right2', text: 'Â§ßÈÉ®ÂàÜÁÇ∫ÈõªÁÜ±‰∏çËâØÂ∞éÈ´î', val: 'poor_conductor' },
                        { id: 'right3', text: 'ÂÖ∑ÊúâÂª∂ÊÄßËàáÂ±ïÊÄß', val: 'ductile' },
                        { id: 'right4', text: 'ÂÆπÊòìË¢´Êï≤Á¢é', val: 'brittle' },
                        { id: 'right5', text: 'Â∞éÈõªÊÄßËàáÂ∞éÁÜ±ÊÄß‰Ω≥', val: 'good_conductor' },
                        { id: 'right6', text: 'È°èËâ≤Â∑ÆÁï∞Â§ß', val: 'various_color' }
                    ],
                    solution: {
                        metal_properties: ['metal_luster', 'good_conductor', 'ductile'],
                        nonmetal_properties: ['various_color', 'brittle', 'poor_conductor']
                    }
                },
                {
                    id: "6-1-3",
                    section: "6-1",
                    title: "Á¨¨‰∏âÈóúÔºöÁâπÊÆäÊÄßË≥™ÈÖçÂ∞ç",
                    description: "Ë´ãÂ∞áÁâπÊÆäÊÄßË≥™ÁöÑÂÖÉÁ¥†ÊàñÁâ©Ë≥™ËàáÂÖ∂ÁâπÊÄßÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'Áü≥Â¢®', val: 'graphite' },
                        { id: 'left2', text: 'ÈëΩÁü≥', val: 'diamond' },
                        { id: 'left3', text: 'Ê±ûÔºàÊ∞¥ÈäÄÔºâ', val: 'mercury' },
                        { id: 'left4', text: 'Èáë', val: 'gold' },
                        { id: 'left5', text: 'ÈäÖ', val: 'copper' },
                        { id: 'left6', text: 'Ê¥ªÊÄßÁ¢≥', val: 'activated_carbon' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: 'Á¢≥ÁöÑÂêåÁ¥†Áï∞ÂΩ¢È´îÔºåÂèØÂ∞éÈõª', val: 'graphite_prop' },
                        { id: 'right2', text: 'Ëá™ÁÑ∂ÁïåÊúÄÁ°¨ÁöÑÁâ©Ë≥™', val: 'diamond_prop' },
                        { id: 'right3', text: 'Â∏∏Ê∫´‰∏ãÂîØ‰∏ÄÊ∂≤ÊÖãÈáëÂ±¨', val: 'mercury_prop' },
                        { id: 'right4', text: 'Âª∂Â±ïÊÄßÊúÄÂ•ΩÁöÑÈáëÂ±¨ÔºåÂëàÈáëÈªÉËâ≤', val: 'gold_prop' },
                        { id: 'right5', text: 'Â∞éÈõªÊÄßÂÉÖÊ¨°ÊñºÈäÄÁöÑÈáëÂ±¨', val: 'copper_prop' },
                        { id: 'right6', text: 'Â§öÂ≠îÈöôÔºåÂê∏ÈôÑÊÄßÈ´òÔºåÂèØÁî®ÊñºÈÅéÊøæ', val: 'activated_carbon_prop' }
                    ],
                    solution: {
                        graphite: ['graphite_prop'],
                        diamond: ['diamond_prop'],
                        mercury: ['mercury_prop'],
                        gold: ['gold_prop'],
                        copper: ['copper_prop'],
                        activated_carbon: ['activated_carbon_prop']
                    }
                }
            ],
            "6-2": [
                {
                    id: "6-2-1",
                    section: "6-2",
                    title: "Á¨¨‰∏ÄÈóúÔºöÂÖÉÁ¥†ÈÄ±ÊúüË°®ÁöÑÊóèËàáÈÄ±Êúü",
                    description: "Ë´ãÂ∞áÂÖÉÁ¥†ËàáÂÖ∂Â∞çÊáâÁöÑÊóèÁæ§ÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'Èàâ (Na)', val: 'Na' },
                        { id: 'left2', text: 'ÈéÇ (Mg)', val: 'Mg' },
                        { id: 'left3', text: 'Ê∞¶ (He)', val: 'He' },
                        { id: 'left4', text: 'Ê∞Ø (Cl)', val: 'Cl' },
                        { id: 'left5', text: 'ÈâÄ (K)', val: 'K' },
                        { id: 'left6', text: 'Èà£ (Ca)', val: 'Ca' },
                        { id: 'left7', text: 'Ê∞ñ (Ne)', val: 'Ne' },
                        { id: 'left8', text: 'Ê∞¨ (Ar)', val: 'Ar' },
                        { id: 'left9', text: 'Èã∞ (Li)', val: 'Li' },
                        { id: 'left10', text: 'Èç∂ (Sr)', val: 'Sr' },
                        { id: 'left11', text: 'Ê∞ü (F)', val: 'F' },
                        { id: 'left12', text: 'Ê∫¥ (Br)', val: 'Br' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: 'Á¨¨1ÊóèÔºàÈπºÈáëÂ±¨Ôºâ', val: 'group1' },
                        { id: 'right2', text: 'Á¨¨2ÊóèÔºàÈπºÂúüÈáëÂ±¨Ôºâ', val: 'group2' },
                        { id: 'right3', text: 'Á¨¨17ÊóèÔºàÈπµÁ¥†Ôºâ', val: 'group17' },
                        { id: 'right4', text: 'Á¨¨18ÊóèÔºàÈàçÊ∞£Ôºâ', val: 'group18' }
                    ],
                    solution: {
                        Na: ['group1'],
                        K: ['group1'],
                        Li: ['group1'],
                        Mg: ['group2'],
                        Ca: ['group2'],
                        Sr: ['group2'],
                        He: ['group18'],
                        Ne: ['group18'],
                        Ar: ['group18'],
                        Cl: ['group17'],
                        F: ['group17'],
                        Br: ['group17']
                    }
                },
                {
                    id: "6-2-2",
                    section: "6-2",
                    title: "Á¨¨‰∫åÈóúÔºöÂêåÊóèÂÖÉÁ¥†ÁöÑÊÄßË≥™",
                    description: "Ë´ãÂ∞á‰ª•‰∏ãÂÖÉÁ¥†‰æùÂÖ∂ÂåñÂ≠∏ÊÄßË≥™Ê≠∏È°û",
                    type: "classification",
                    zones: [
                        { id: 'alkali', title: 'ÈπºÈáëÂ±¨ÔºàÊòìËàáÊ∞¥ÂèçÊáâÔºâ', icon: 'fa-flask' },
                        { id: 'noble', title: 'ÈàçÊ∞£ÔºàÂåñÂ≠∏ÊÄßË≥™ÂÆâÂÆöÔºâ', icon: 'fa-shield-alt' }
                    ],
                    items: [
                        { id: 'item1', text: 'Èàâ (Na)', val: 'Na' },
                        { id: 'item2', text: 'ÈâÄ (K)', val: 'K' },
                        { id: 'item3', text: 'Ê∞¶ (He)', val: 'He' },
                        { id: 'item4', text: 'Ê∞ñ (Ne)', val: 'Ne' },
                        { id: 'item5', text: 'Èã∞ (Li)', val: 'Li' },
                        { id: 'item6', text: 'Ê∞¨ (Ar)', val: 'Ar' }
                    ],
                    solution: {
                        alkali: ['Na', 'K', 'Li'],
                        noble: ['He', 'Ne', 'Ar']
                    }
                }
            ],
            "6-3": [
                {
                    id: "6-3-1",
                    section: "6-3",
                    title: "Á¨¨‰∏ÄÈóúÔºöÈÅìËÄ≥È†ìÁöÑÂéüÂ≠êË™™",
                    description: "Ë´ãÂ∞áÂéüÂ≠êË™™ÁöÑË¶ÅÈªûËàáÂ∞çÊáâÁöÑÂØ¶‰æãÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'Áâ©Ë≥™Áî±ÂéüÂ≠êÁµÑÊàê', val: 'concept1' },
                        { id: 'left2', text: 'Áõ∏ÂêåÂÖÉÁ¥†ÁöÑÂéüÂ≠êÊÄßË≥™Áõ∏Âêå', val: 'concept2' },
                        { id: 'left3', text: 'ÂåñÂêàÁâ©Áî±‰∏çÂêåÂéüÂ≠ê‰ª•Âõ∫ÂÆöÊØî‰æãÁµÑÊàê', val: 'concept3' },
                        { id: 'left4', text: 'ÂåñÂ≠∏ÂèçÊáâÊòØÂéüÂ≠êÈáçÊñ∞ÁµÑÂêà', val: 'concept4' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: 'ÈáëÊòØÁî±ÈáëÂéüÂ≠êÁµÑÊàê', val: 'example1' },
                        { id: 'right2', text: 'ÊâÄÊúâÊ∞ßÂéüÂ≠êÁöÑË≥™ÈáèÁõ∏Âêå', val: 'example2' },
                        { id: 'right3', text: 'Ê∞¥ÂàÜÂ≠êÁî±2ÂÄãÊ∞´ÂéüÂ≠êÂíå1ÂÄãÊ∞ßÂéüÂ≠êÁµÑÊàê', val: 'example3' },
                        { id: 'right4', text: 'Ê∞´Ê∞£ËàáÊ∞ßÊ∞£ÂèçÊáâÁîüÊàêÊ∞¥', val: 'example4' }
                    ],
                    solution: {
                        concept1: ['example1'],
                        concept2: ['example2'],
                        concept3: ['example3'],
                        concept4: ['example4']
                    }
                },
                {
                    id: "6-3-2",
                    section: "6-3",
                    title: "Á¨¨‰∫åÈóúÔºöÂéüÂ≠êÁµêÊßãÁöÑÁµÑÊàê",
                    description: "Ë´ãÂ∞áÂéüÂ≠êÁöÑÁµÑÊàêÁ≤íÂ≠êÂ°´ÂÖ•Ê≠£Á¢∫‰ΩçÁΩÆ",
                    type: "formula",
                    formulaSlots: [
                        { id: 'slot1', position: 'left', placeholder: 'ÂéüÂ≠êÊ†∏ = Ôºü + Ôºü' },
                        { id: 'slot2', position: 'right', placeholder: 'ÂéüÂ≠ê = ÂéüÂ≠êÊ†∏ + Ôºü' }
                    ],
                    items: [
                        { id: 'item1', text: 'Ë≥™Â≠ê', val: 'proton' },
                        { id: 'item2', text: '‰∏≠Â≠ê', val: 'neutron' },
                        { id: 'item3', text: 'ÈõªÂ≠ê', val: 'electron' }
                    ],
                    solution: {
                        slot1: ['proton', 'neutron'],
                        slot2: ['electron']
                    }
                },
                {
                    id: "6-3-3",
                    section: "6-3",
                    title: "Á¨¨‰∏âÈóúÔºöË≥™ÈáèÊï∏ËàáÂéüÂ≠êÂ∫èË®àÁÆó",
                    description: "Â∑≤Áü•ÈàπÂéüÂ≠êÔºà‚Åπ‚ÇÑBeÔºâÔºåË´ãË®àÁÆóÂÖ∂Ë≥™Â≠êÊï∏„ÄÅ‰∏≠Â≠êÊï∏ËàáÈõªÂ≠êÊï∏",
                    type: "formula",
                    formulaSlots: [
                        { id: 'slot1', position: 'left', placeholder: 'Ë≥™Â≠êÊï∏ = Ôºü' },
                        { id: 'slot2', position: 'middle', placeholder: '‰∏≠Â≠êÊï∏ = Ôºü' },
                        { id: 'slot3', position: 'right', placeholder: 'ÈõªÂ≠êÊï∏ = Ôºü' }
                    ],
                    items: [
                        { id: 'item1', text: '4', val: '4' },
                        { id: 'item2', text: '5', val: '5' },
                        { id: 'item3', text: '9', val: '9' }
                    ],
                    solution: {
                        slot1: ['4'],
                        slot2: ['5'],
                        slot3: ['4']
                    }
                }
            ],
            "6-4": [
                {
                    id: "6-4-1",
                    section: "6-4",
                    title: "Á¨¨‰∏ÄÈóúÔºöÂàÜÂ≠êÁöÑÁµÑÊàê",
                    description: "Ë´ãÂ∞áÂàÜÂ≠êËàáÂÖ∂ÁµÑÊàêÂéüÂ≠êÊï∏ÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'Ê∞´Ê∞£ (H‚ÇÇ)', val: 'H2' },
                        { id: 'left2', text: 'Ê∞¥ (H‚ÇÇO)', val: 'H2O' },
                        { id: 'left3', text: 'Ëá≠Ê∞ß (O‚ÇÉ)', val: 'O3' },
                        { id: 'left4', text: 'Ê∞¶Ê∞£ (He)', val: 'He' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: '1ÂÄãÂéüÂ≠ê', val: '1atom' },
                        { id: 'right2', text: '2ÂÄãÂéüÂ≠ê', val: '2atoms' },
                        { id: 'right3', text: '3ÂÄãÂéüÂ≠êÔºàÂêåÁ®ÆÔºâ', val: '3atoms_same' },
                        { id: 'right4', text: '3ÂÄãÂéüÂ≠êÔºà‰∏çÂêåÁ®ÆÔºâ', val: '3atoms_diff' }
                    ],
                    solution: {
                        H2: ['2atoms'],
                        H2O: ['3atoms_diff'],
                        O3: ['3atoms_same'],
                        He: ['1atom']
                    }
                },
                {
                    id: "6-4-2",
                    section: "6-4",
                    title: "Á¨¨‰∫åÈóúÔºöÂåñÂ≠∏ÂºèÁöÑÊõ∏ÂØ´Ë¶èÂâá",
                    description: "Ë´ãÂ∞áÁâ©Ë≥™ÂêçÁ®±ËàáÂÖ∂Ê≠£Á¢∫ÂåñÂ≠∏ÂºèÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'Ê∞¥', val: 'water' },
                        { id: 'left2', text: 'Ê∞ßÊ∞£', val: 'oxygen' },
                        { id: 'left3', text: 'Ê∞ØÂåñÈàâ', val: 'sodium_chloride' },
                        { id: 'left4', text: '‰∫åÊ∞ßÂåñÁ¢≥', val: 'carbon_dioxide' },
                        { id: 'left5', text: 'Ê∞ÆÊ∞£', val: 'nitrogen' },
                        { id: 'left6', text: 'Ëá≠Ê∞ß', val: 'ozone' },
                        { id: 'left7', text: '‰∏ÄÊ∞ßÂåñÁ¢≥', val: 'carbon_monoxide' },
                        { id: 'left8', text: 'Ê∞®', val: 'ammonia' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: 'H‚ÇÇO', val: 'H2O' },
                        { id: 'right2', text: 'O‚ÇÇ', val: 'O2' },
                        { id: 'right3', text: 'NaCl', val: 'NaCl' },
                        { id: 'right4', text: 'CO‚ÇÇ', val: 'CO2' },
                        { id: 'right5', text: 'N‚ÇÇ', val: 'N2' },
                        { id: 'right6', text: 'O‚ÇÉ', val: 'O3' },
                        { id: 'right7', text: 'CO', val: 'CO' },
                        { id: 'right8', text: 'NH‚ÇÉ', val: 'NH3' }
                    ],
                    solution: {
                        water: ['H2O'],
                        oxygen: ['O2'],
                        sodium_chloride: ['NaCl'],
                        carbon_dioxide: ['CO2'],
                        nitrogen: ['N2'],
                        ozone: ['O3'],
                        carbon_monoxide: ['CO'],
                        ammonia: ['NH3']
                    }
                },
                {
                    id: "6-4-3",
                    section: "6-4",
                    title: "Á¨¨‰∏âÈóúÔºöÁâ©Ë≥™ÁöÑÂàÜÈ°ûËàáÂÆöÁæ©ÈÖçÂ∞ç",
                    description: "Ë´ãÂ∞áÁâ©Ë≥™ÂàÜÈ°ûËàáÂÖ∂ÂÆöÁæ©ÈÖçÂ∞ç",
                    type: "formula_match",
                    leftOptions: [
                        { id: 'left1', text: 'ÂÖÉÁ¥†', val: 'element' },
                        { id: 'left2', text: 'ÂåñÂêàÁâ©', val: 'compound' },
                        { id: 'left3', text: 'Ê∑∑ÂêàÁâ©', val: 'mixture' },
                        { id: 'left4', text: 'Á¥îÁâ©Ë≥™', val: 'pure_substance' }
                    ],
                    rightOptions: [
                        { id: 'right1', text: 'Áî±Âêå‰∏ÄÁ®ÆÂéüÂ≠êÊßãÊàêÁöÑÁ¥îÁâ©Ë≥™', val: 'element_def' },
                        { id: 'right2', text: '‰∏çÂêåÁ®ÆÈ°ûÁöÑÂéüÂ≠ê‰ª•Âõ∫ÂÆöÊØî‰æãÁµêÂêàËÄåÊàêÁöÑÁ¥îÁâ©Ë≥™', val: 'compound_def' },
                        { id: 'right3', text: 'ÂÖ©Á®ÆÊàñÂÖ©Á®Æ‰ª•‰∏äÁ¥îÁâ©Ë≥™Ê∑∑ÂêàËÄåÊàê', val: 'mixture_def' },
                        { id: 'right4', text: 'Áî±ÂñÆ‰∏ÄÁ®ÆÁâ©Ë≥™ÁµÑÊàê', val: 'pure_def' }
                    ],
                    solution: {
                        element: ['element_def'],
                        compound: ['compound_def'],
                        mixture: ['mixture_def'],
                        pure_substance: ['pure_def']
                    }
                }
            ]
        };

        // ===========================================
        // THEME COLORS
        // ===========================================
        const themeColors = {
            '6-1': { 
                primary: 'from-green-400 to-teal-600',
                header: 'from-green-500 to-teal-700', 
                badge: 'bg-green-500' 
            },
            '6-2': { 
                primary: 'from-blue-400 to-cyan-600',
                header: 'from-blue-500 to-cyan-700', 
                badge: 'bg-blue-500' 
            },
            '6-3': { 
                primary: 'from-purple-400 to-pink-600',
                header: 'from-purple-500 to-pink-700', 
                badge: 'bg-purple-500' 
            },
            '6-4': { 
                primary: 'from-orange-400 to-red-600',
                header: 'from-orange-500 to-red-700', 
                badge: 'bg-orange-500' 
            }
        };

        // ===========================================
        // MAIN APP COMPONENT
        // ===========================================
        function App() {
            const [screen, setScreen] = useState('section_select');
            const [currentSection, setCurrentSection] = useState(null);
            const [currentLevelIndex, setCurrentLevelIndex] = useState(0);
            const [gameState, setGameState] = useState('playing');
            const [droppedItems, setDroppedItems] = useState({});
            const [startTime, setStartTime] = useState(null);
            const [elapsedTime, setElapsedTime] = useState(0);
            const [attempts, setAttempts] = useState(0);
            const [draggedItem, setDraggedItem] = useState(null);
            const [sectionCompletionStatus, setSectionCompletionStatus] = useState({});
            const [errorLog, setErrorLog] = useState([]);
            const [fontScale, setFontScale] = useState(100);

            const currentLevel = currentSection ? CHAPTER_DATA[currentSection][currentLevelIndex] : null;
            const totalLevels = currentSection ? CHAPTER_DATA[currentSection].length : 0;

            // Load completion status and font scale from localStorage
            useEffect(() => {
                const saved = localStorage.getItem('chapter6_completion_status');
                if (saved) {
                    setSectionCompletionStatus(JSON.parse(saved));
                }
                const savedFontScale = localStorage.getItem('chapter6_font_scale');
                if (savedFontScale) {
                    setFontScale(parseInt(savedFontScale));
                }
            }, []);

            // Apply font scale
            useEffect(() => {
                document.documentElement.style.fontSize = `${fontScale}%`;
                localStorage.setItem('chapter6_font_scale', fontScale.toString());
            }, [fontScale]);

            // Timer
            useEffect(() => {
                let timer;
                if (gameState === 'playing' && startTime) {
                    timer = setInterval(() => {
                        setElapsedTime(Math.floor((new Date() - startTime) / 1000));
                    }, 1000);
                }
                return () => {
                    if (timer) clearInterval(timer);
                };
            }, [gameState, startTime]);

            // Start section
            const startSection = (sectionId) => {
                setCurrentSection(sectionId);
                setCurrentLevelIndex(0);
                setScreen('game');
                setGameState('playing');
                setDroppedItems({});
                setStartTime(new Date());
                setElapsedTime(0);
                setAttempts(0);
                setErrorLog([]);
            };

            // Drag handlers
            const handleDragStart = (e, item) => {
                setDraggedItem(item);
                e.dataTransfer.effectAllowed = 'move';
                if (e.target) {
                    e.target.style.opacity = '0.5';
                }
            };

            const handleDragEnd = (e) => {
                if (e.target) {
                    e.target.style.opacity = '1';
                }
                setDraggedItem(null);
            };

            const handleDrop = (e, zoneId) => {
                e.preventDefault();
                if (!draggedItem) return;

                const newDroppedItems = { ...droppedItems };
                
                // Remove item from all zones
                Object.keys(newDroppedItems).forEach(key => {
                    newDroppedItems[key] = newDroppedItems[key].filter(val => val !== draggedItem.val);
                });

                // Add to new zone
                if (!newDroppedItems[zoneId]) {
                    newDroppedItems[zoneId] = [];
                }
                newDroppedItems[zoneId].push(draggedItem.val);

                setDroppedItems(newDroppedItems);
                setDraggedItem(null);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            };

            // Touch handlers
            const handleTouchStart = (e, item) => {
                setDraggedItem(item);
                document.body.style.overflow = 'hidden';
            };

            const handleTouchMove = (e) => {
                e.preventDefault();
            };

            const handleTouchEnd = (e, zoneId) => {
                if (!draggedItem) return;
                
                document.body.style.overflow = '';
                
                const touch = e.changedTouches[0];
                const dropZone = document.elementFromPoint(touch.clientX, touch.clientY);
                
                if (dropZone && dropZone.dataset.zone) {
                    const targetZoneId = dropZone.dataset.zone;
                    const newDroppedItems = { ...droppedItems };
                    
                    Object.keys(newDroppedItems).forEach(key => {
                        newDroppedItems[key] = newDroppedItems[key].filter(val => val !== draggedItem.val);
                    });

                    if (!newDroppedItems[targetZoneId]) {
                        newDroppedItems[targetZoneId] = [];
                    }
                    newDroppedItems[targetZoneId].push(draggedItem.val);

                    setDroppedItems(newDroppedItems);
                }
                
                setDraggedItem(null);
            };

            // Check answer
            const checkAnswer = () => {
                setAttempts(prev => prev + 1);
                
                const solution = currentLevel.solution;
                let allCorrect = true;
                const newErrorLog = [...errorLog];

                if (currentLevel.type === 'classification') {
                    Object.keys(solution).forEach(zoneId => {
                        const expected = solution[zoneId].sort();
                        const actual = (droppedItems[zoneId] || []).sort();
                        
                        if (JSON.stringify(expected) !== JSON.stringify(actual)) {
                            allCorrect = false;
                            
                            // Record errors
                            actual.forEach(val => {
                                if (!expected.includes(val)) {
                                    const wrongItem = currentLevel.items.find(item => item.val === val);
                                    const wrongZone = currentLevel.zones.find(zone => zone.id === zoneId);
                                    const correctZoneId = Object.keys(solution).find(key => solution[key].includes(val));
                                    const correctZone = currentLevel.zones.find(zone => zone.id === correctZoneId);
                                    
                                    if (wrongItem && wrongZone && correctZone) {
                                        newErrorLog.push({
                                            levelTitle: currentLevel.title,
                                            wrongAnswer: `${wrongItem.text} ‚Üí ${wrongZone.title}`,
                                            correctAnswer: `${wrongItem.text} ‚Üí ${correctZone.title}`
                                        });
                                    }
                                }
                            });
                        }
                    });
                } else if (currentLevel.type === 'formula_match') {
                    Object.keys(solution).forEach(leftId => {
                        const expected = solution[leftId];
                        const actual = droppedItems[leftId] || [];
                        
                        if (JSON.stringify(expected.sort()) !== JSON.stringify(actual.sort())) {
                            allCorrect = false;
                            
                            const wrongLeft = currentLevel.leftOptions.find(opt => opt.val === leftId);
                            if (wrongLeft) {
                                const actualRights = actual.map(val => {
                                    const right = currentLevel.rightOptions.find(opt => opt.val === val);
                                    return right ? right.text : '';
                                }).join(', ');
                                
                                const correctRights = expected.map(val => {
                                    const right = currentLevel.rightOptions.find(opt => opt.val === val);
                                    return right ? right.text : '';
                                }).join(', ');
                                
                                newErrorLog.push({
                                    levelTitle: currentLevel.title,
                                    wrongAnswer: `${wrongLeft.text} ‚Üí ${actualRights || '(Êú™ÈÖçÂ∞ç)'}`,
                                    correctAnswer: `${wrongLeft.text} ‚Üí ${correctRights}`
                                });
                            }
                        }
                    });
                } else if (currentLevel.type === 'formula') {
                    Object.keys(solution).forEach(slotId => {
                        const expected = solution[slotId].sort();
                        const actual = (droppedItems[slotId] || []).sort();
                        
                        if (JSON.stringify(expected) !== JSON.stringify(actual)) {
                            allCorrect = false;
                            
                            const slot = currentLevel.formulaSlots.find(s => s.id === slotId);
                            if (slot) {
                                const actualItems = actual.map(val => {
                                    const item = currentLevel.items.find(i => i.val === val);
                                    return item ? item.text : '';
                                }).join(', ');
                                
                                const correctItems = expected.map(val => {
                                    const item = currentLevel.items.find(i => i.val === val);
                                    return item ? item.text : '';
                                }).join(', ');
                                
                                newErrorLog.push({
                                    levelTitle: currentLevel.title,
                                    wrongAnswer: `${slot.placeholder} = ${actualItems || '(Á©∫ÁôΩ)'}`,
                                    correctAnswer: `${slot.placeholder} = ${correctItems}`
                                });
                            }
                        }
                    });
                }

                setErrorLog(newErrorLog);

                if (allCorrect) {
                    setGameState('completed');
                } else {
                    setGameState('wrong');
                    setTimeout(() => {
                        setGameState('playing');
                    }, 2000);
                }
            };

            // Next level
            const nextLevel = () => {
                if (currentLevelIndex < totalLevels - 1) {
                    setCurrentLevelIndex(prev => prev + 1);
                    setGameState('playing');
                    setDroppedItems({});
                } else {
                    // Section completed
                    const totalTime = elapsedTime;
                    const totalErrors = errorLog.length;
                    
                    const newStatus = {
                        ...sectionCompletionStatus,
                        [currentSection]: {
                            completed: true,
                            completedAt: new Date().toISOString(),
                            totalTime: totalTime,
                            attempts: attempts,
                            errors: totalErrors,
                            errorLog: errorLog
                        }
                    };
                    
                    setSectionCompletionStatus(newStatus);
                    localStorage.setItem('chapter6_completion_status', JSON.stringify(newStatus));
                    
                    setScreen('section_complete');
                }
            };

            // Download certificate
            const downloadCertificate = (elementId, filename) => {
                const element = document.getElementById(elementId);
                if (!element) return;

                html2canvas(element, { scale: 2 }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = canvas.toDataURL();
                    link.click();
                });
            };

            // Clear all progress
            const clearAllProgress = () => {
                if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÂÆåÊàêË®òÈåÑÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
                    localStorage.removeItem('chapter6_completion_status');
                    setSectionCompletionStatus({});
                    alert('ÊâÄÊúâË®òÈåÑÂ∑≤Ê∏ÖÈô§ÔºÅ');
                }
            };

            // Check if all placed
            const checkAllPlaced = () => {
                if (!currentLevel) return false;
                
                const totalItems = currentLevel.items ? currentLevel.items.length : 
                                 (currentLevel.leftOptions ? currentLevel.leftOptions.length : 0);
                const placedItems = Object.values(droppedItems).flat().length;
                
                return placedItems === totalItems;
            };

            const allPlaced = checkAllPlaced();
            const totalItems = currentLevel && currentLevel.items ? currentLevel.items.length : 
                             (currentLevel && currentLevel.leftOptions ? currentLevel.leftOptions.length : 0);
            const placedItems = Object.values(droppedItems).flat().length;

            // Check if all sections completed
            const allSectionsCompleted = Object.keys(CHAPTER_DATA).every(
                sectionId => sectionCompletionStatus[sectionId]?.completed
            );

            // ===========================================
            // RENDER: SECTION SELECT
            // ===========================================
            if (screen === 'section_select') {
                const sections = [
                    { id: '6-1', title: '6-1 ÂÖÉÁ¥†ÁöÑÊé¢Á¥¢', icon: 'fa-flask', levels: 3, color: 'from-green-400 to-teal-600' },
                    { id: '6-2', title: '6-2 ÂÖÉÁ¥†ÈÄ±ÊúüË°®', icon: 'fa-table', levels: 2, color: 'from-blue-400 to-cyan-600' },
                    { id: '6-3', title: '6-3 ÂåñÂêàÁâ©ËàáÂéüÂ≠êÊ¶ÇÂøµÁöÑÁôºÂ±ï', icon: 'fa-atom', levels: 3, color: 'from-purple-400 to-pink-600' },
                    { id: '6-4', title: '6-4 ÂàÜÂ≠êËàáÂåñÂ≠∏Âºè', icon: 'fa-dna', levels: 3, color: 'from-orange-400 to-red-600' }
                ];

                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-4">
                        <div className="max-w-6xl mx-auto">
                            {/* Header */}
                            <div className="text-center mb-8 mt-8">
                                <div className="flex justify-between items-center mb-4">
                                    <div className="flex-1"></div>
                                    <h1 className="flex-1 text-4xl md:text-5xl font-black text-white drop-shadow-lg">
                                        Á¨¨6Á´† Êé¢Á¥¢Áâ©Ë≥™ÁµÑÊàê
                                    </h1>
                                    <div className="flex-1 flex justify-end items-center gap-2">
                                        <button
                                            onClick={() => setFontScale(Math.max(70, fontScale - 10))}
                                            className="bg-white/20 hover:bg-white/30 text-white px-3 py-2 rounded-lg backdrop-blur-sm transition-all"
                                            title="Á∏ÆÂ∞èÂ≠óÈ´î"
                                        >
                                            A‚Åª
                                        </button>
                                        <button
                                            onClick={() => setFontScale(Math.min(150, fontScale + 10))}
                                            className="bg-white/20 hover:bg-white/30 text-white px-3 py-2 rounded-lg backdrop-blur-sm transition-all"
                                            title="ÊîæÂ§ßÂ≠óÈ´î"
                                        >
                                            A‚Å∫
                                        </button>
                                    </div>
                                </div>
                                <p className="text-xl text-white/90 mt-2">ÈÅ∏ÊìáÂ∞èÁØÄÈñãÂßãÈóñÈóú</p>
                            </div>

                            {/* Sections Grid */}
                            <div className="grid md:grid-cols-2 gap-6 mb-8">
                                {sections.map(section => {
                                    const isCompleted = sectionCompletionStatus[section.id]?.completed;
                                    return (
                                        <div
                                            key={section.id}
                                            onClick={() => startSection(section.id)}
                                            className="glass-effect rounded-2xl p-6 cursor-pointer hover:scale-105 transition-transform relative overflow-hidden group"
                                        >
                                            <div className={`absolute inset-0 bg-gradient-to-br ${section.color} opacity-20 group-hover:opacity-30 transition-opacity`}></div>
                                            <div className="relative z-10">
                                                <div className="flex items-center justify-between mb-4">
                                                    <div className="flex items-center gap-3">
                                                        <i className={`fas ${section.icon} text-3xl text-white`}></i>
                                                        <h3 className="text-xl font-bold text-white">{section.title}</h3>
                                                    </div>
                                                    {isCompleted && (
                                                        <div className="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                            <i className="fas fa-check mr-1"></i>
                                                            Â∑≤ÂÆåÊàê
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="text-white/80">
                                                    <i className="fas fa-gamepad mr-2"></i>
                                                    ÂÖ± {section.levels} ÂÄãÈóúÂç°
                                                </div>
                                                {isCompleted && sectionCompletionStatus[section.id] && (
                                                    <div className="mt-3 text-sm text-white/70">
                                                        <div>ÂÆåÊàêÊôÇÈñìÔºö{sectionCompletionStatus[section.id].totalTime} Áßí</div>
                                                        <div>ÂòóË©¶Ê¨°Êï∏Ôºö{sectionCompletionStatus[section.id].attempts} Ê¨°</div>
                                                        <div>ÈåØË™§Ê¨°Êï∏Ôºö{sectionCompletionStatus[section.id].errors} Ê¨°</div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            {/* All Complete Certificate */}
                            {allSectionsCompleted && (
                                <div className="glass-effect rounded-2xl p-6 mb-8">
                                    <div className="text-center">
                                        <i className="fas fa-trophy text-6xl text-yellow-300 mb-4"></i>
                                        <h2 className="text-3xl font-bold text-white mb-4">üéâ ÊÅ≠ÂñúÂÆåÊàêÊâÄÊúâÂ∞èÁØÄÔºÅ</h2>
                                        <button
                                            onClick={() => setScreen('all_complete')}
                                            className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-8 py-3 rounded-xl font-bold hover:scale-105 transition-transform"
                                        >
                                            <i className="fas fa-certificate mr-2"></i>
                                            Êü•ÁúãÂÆåÊàêË≠âÊõ∏
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Clear Progress Button */}
                            <div className="text-center">
                                <button
                                    onClick={clearAllProgress}
                                    className="bg-red-500/80 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-bold transition-all"
                                >
                                    <i className="fas fa-trash-alt mr-2"></i>
                                    Ê∏ÖÈô§ÊâÄÊúâÂÆåÊàêË®òÈåÑ
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // ===========================================
            // RENDER: GAME SCREEN
            // ===========================================
            if (screen === 'game' && currentLevel) {
                const colors = themeColors[currentSection];
                
                return (
                    <div className={`min-h-screen bg-gradient-to-br ${colors.primary} p-4`}>
                        <div className="max-w-6xl mx-auto">
                            {/* Header */}
                            <div className={`bg-gradient-to-r ${colors.header} rounded-2xl p-4 mb-6 shadow-lg`}>
                                <div className="flex flex-wrap items-center justify-between gap-4">
                                    <div className="flex items-center gap-2">
                                        <button
                                            onClick={() => setFontScale(Math.max(70, fontScale - 10))}
                                            className="bg-white/20 hover:bg-white/30 text-white px-2 py-1 rounded text-sm"
                                        >
                                            A‚Åª
                                        </button>
                                        <button
                                            onClick={() => setFontScale(Math.min(150, fontScale + 10))}
                                            className="bg-white/20 hover:bg-white/30 text-white px-2 py-1 rounded text-sm"
                                        >
                                            A‚Å∫
                                        </button>
                                        <h2 className="text-2xl font-bold text-white ml-2">{currentLevel.title}</h2>
                                    </div>
                                    <div className="flex items-center gap-4 text-white">
                                        <div className="progress-bar bg-white/20 rounded-full px-4 py-2">
                                            <i className="fas fa-layer-group mr-2"></i>
                                            ÈóúÂç° {currentLevelIndex + 1}/{totalLevels}
                                        </div>
                                        <div className="bg-white/20 rounded-full px-4 py-2">
                                            <i className="fas fa-clock mr-2"></i>
                                            {elapsedTime} Áßí
                                        </div>
                                        <div className="bg-white/20 rounded-full px-4 py-2">
                                            <i className="fas fa-redo mr-2"></i>
                                            {attempts} Ê¨°
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Description */}
                            <div className="bg-white rounded-xl p-6 mb-6 shadow-lg">
                                <p className="text-lg text-gray-700">{currentLevel.description}</p>
                            </div>

                            {/* Classification Type */}
                            {currentLevel.type === 'classification' && (
                                <div className="grid md:grid-cols-2 gap-6 mb-6">
                                    {currentLevel.zones.map(zone => (
                                        <div
                                            key={zone.id}
                                            data-zone={zone.id}
                                            onDrop={(e) => handleDrop(e, zone.id)}
                                            onDragOver={handleDragOver}
                                            onTouchEnd={(e) => handleTouchEnd(e, zone.id)}
                                            className={`drop-zone bg-white rounded-xl p-6 border-4 ${
                                                gameState === 'wrong' && 
                                                JSON.stringify((droppedItems[zone.id] || []).sort()) !== 
                                                JSON.stringify((currentLevel.solution[zone.id] || []).sort())
                                                    ? 'border-red-500 shake' 
                                                    : gameState === 'completed'
                                                    ? 'border-green-500'
                                                    : 'border-dashed border-gray-300'
                                            }`}
                                        >
                                            <div className="flex items-center gap-3 mb-4">
                                                <i className={`fas ${zone.icon} text-2xl ${colors.badge} text-white p-3 rounded-lg`}></i>
                                                <h3 className="text-xl font-bold text-gray-800">{zone.title}</h3>
                                            </div>
                                            <div className="space-y-2">
                                                {(droppedItems[zone.id] || []).map(val => {
                                                    const item = currentLevel.items.find(i => i.val === val);
                                                    return item ? (
                                                        <div
                                                            key={item.id}
                                                            draggable
                                                            onDragStart={(e) => handleDragStart(e, item)}
                                                            onDragEnd={handleDragEnd}
                                                            onTouchStart={(e) => handleTouchStart(e, item)}
                                                            onTouchMove={handleTouchMove}
                                                            className="drag-item bg-blue-500 text-white px-4 py-3 rounded-lg cursor-move hover:bg-blue-600 transition-colors"
                                                        >
                                                            {item.text}
                                                        </div>
                                                    ) : null;
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Formula Match Type */}
                            {currentLevel.type === 'formula_match' && (
                                <div className="grid md:grid-cols-2 gap-6 mb-6">
                                    <div className="space-y-4">
                                        <h3 className="text-xl font-bold text-white mb-4">Â∑¶ÂÅ¥ÈÅ∏È†Ö</h3>
                                        {currentLevel.leftOptions.map(left => (
                                            <div
                                                key={left.id}
                                                data-zone={left.val}
                                                onDrop={(e) => handleDrop(e, left.val)}
                                                onDragOver={handleDragOver}
                                                onTouchEnd={(e) => handleTouchEnd(e, left.val)}
                                                className={`drop-zone bg-white rounded-xl p-4 border-4 ${
                                                    gameState === 'wrong' && 
                                                    JSON.stringify((droppedItems[left.val] || []).sort()) !== 
                                                    JSON.stringify((currentLevel.solution[left.val] || []).sort())
                                                        ? 'border-red-500 shake' 
                                                        : gameState === 'completed'
                                                        ? 'border-green-500'
                                                        : 'border-dashed border-gray-300'
                                                }`}
                                            >
                                                <div className="font-bold text-gray-800 mb-2">{left.text}</div>
                                                <div className="min-h-[60px] space-y-2">
                                                    {(droppedItems[left.val] || []).map(val => {
                                                        const right = currentLevel.rightOptions.find(r => r.val === val);
                                                        return right ? (
                                                            <div
                                                                key={right.id}
                                                                draggable
                                                                onDragStart={(e) => handleDragStart(e, right)}
                                                                onDragEnd={handleDragEnd}
                                                                onTouchStart={(e) => handleTouchStart(e, right)}
                                                                onTouchMove={handleTouchMove}
                                                                className="drag-item bg-purple-500 text-white px-3 py-2 rounded-lg cursor-move hover:bg-purple-600 transition-colors text-sm"
                                                            >
                                                                {right.text}
                                                            </div>
                                                        ) : null;
                                                    })}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div>
                                        <h3 className="text-xl font-bold text-white mb-4">Âè≥ÂÅ¥ÈÅ∏È†Ö</h3>
                                        <div
                                            data-zone="options"
                                            onDrop={(e) => handleDrop(e, 'options')}
                                            onDragOver={handleDragOver}
                                            onTouchEnd={(e) => handleTouchEnd(e, 'options')}
                                            className="drop-zone bg-white rounded-xl p-4 min-h-[200px] border-4 border-dashed border-gray-300"
                                        >
                                            <div className="space-y-2">
                                                {currentLevel.rightOptions.filter(right => {
                                                    const isPlaced = Object.values(droppedItems).flat().includes(right.val);
                                                    return !isPlaced;
                                                }).map(right => (
                                                    <div
                                                        key={right.id}
                                                        draggable
                                                        onDragStart={(e) => handleDragStart(e, right)}
                                                        onDragEnd={handleDragEnd}
                                                        onTouchStart={(e) => handleTouchStart(e, right)}
                                                        onTouchMove={handleTouchMove}
                                                        className="drag-item bg-purple-500 text-white px-4 py-3 rounded-lg cursor-move hover:bg-purple-600 transition-colors"
                                                    >
                                                        {right.text}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Formula Type */}
                            {currentLevel.type === 'formula' && (
                                <div className="space-y-6 mb-6">
                                    <div className="grid md:grid-cols-3 gap-4">
                                        {currentLevel.formulaSlots.map(slot => (
                                            <div
                                                key={slot.id}
                                                data-zone={slot.id}
                                                onDrop={(e) => handleDrop(e, slot.id)}
                                                onDragOver={handleDragOver}
                                                onTouchEnd={(e) => handleTouchEnd(e, slot.id)}
                                                className={`drop-zone bg-white rounded-xl p-4 border-4 ${
                                                    gameState === 'wrong' && 
                                                    JSON.stringify((droppedItems[slot.id] || []).sort()) !== 
                                                    JSON.stringify((currentLevel.solution[slot.id] || []).sort())
                                                        ? 'border-red-500 shake' 
                                                        : gameState === 'completed'
                                                        ? 'border-green-500'
                                                        : 'border-dashed border-gray-300'
                                                }`}
                                            >
                                                <div className="font-bold text-gray-700 mb-2">{slot.placeholder}</div>
                                                <div className="min-h-[60px] space-y-2">
                                                    {(droppedItems[slot.id] || []).map(val => {
                                                        const item = currentLevel.items.find(i => i.val === val);
                                                        return item ? (
                                                            <div
                                                                key={item.id}
                                                                draggable
                                                                onDragStart={(e) => handleDragStart(e, item)}
                                                                onDragEnd={handleDragEnd}
                                                                onTouchStart={(e) => handleTouchStart(e, item)}
                                                                onTouchMove={handleTouchMove}
                                                                className="drag-item bg-orange-500 text-white px-3 py-2 rounded-lg cursor-move hover:bg-orange-600 transition-colors"
                                                            >
                                                                {item.text}
                                                            </div>
                                                        ) : null;
                                                    })}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div>
                                        <h3 className="text-xl font-bold text-white mb-4">ÂæÖÂàÜÈ°ûÈ†ÖÁõÆ</h3>
                                        <div
                                            data-zone="items"
                                            onDrop={(e) => handleDrop(e, 'items')}
                                            onDragOver={handleDragOver}
                                            onTouchEnd={(e) => handleTouchEnd(e, 'items')}
                                            className="drop-zone bg-white rounded-xl p-4 min-h-[100px] border-4 border-dashed border-gray-300"
                                        >
                                            <div className="flex flex-wrap gap-2">
                                                {currentLevel.items.filter(item => {
                                                    const isPlaced = Object.values(droppedItems).flat().includes(item.val);
                                                    return !isPlaced;
                                                }).map(item => (
                                                    <div
                                                        key={item.id}
                                                        draggable
                                                        onDragStart={(e) => handleDragStart(e, item)}
                                                        onDragEnd={handleDragEnd}
                                                        onTouchStart={(e) => handleTouchStart(e, item)}
                                                        onTouchMove={handleTouchMove}
                                                        className="drag-item bg-orange-500 text-white px-4 py-3 rounded-lg cursor-move hover:bg-orange-600 transition-colors"
                                                    >
                                                        {item.text}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Items Pool for Classification */}
                            {currentLevel.type === 'classification' && (
                                <div>
                                    <h3 className="text-2xl font-bold text-white mb-4">ÂæÖÂàÜÈ°ûÈ†ÖÁõÆ</h3>
                                    <div
                                        data-zone="items"
                                        onDrop={(e) => handleDrop(e, 'items')}
                                        onDragOver={handleDragOver}
                                        onTouchEnd={(e) => handleTouchEnd(e, 'items')}
                                        className="drop-zone bg-white rounded-xl p-6 min-h-[120px] border-4 border-dashed border-gray-300"
                                    >
                                        <div className="flex flex-wrap gap-3">
                                            {currentLevel.items.filter(item => {
                                                const isPlaced = Object.values(droppedItems).flat().includes(item.val);
                                                return !isPlaced;
                                            }).map(item => (
                                                <div
                                                    key={item.id}
                                                    draggable
                                                    onDragStart={(e) => handleDragStart(e, item)}
                                                    onDragEnd={handleDragEnd}
                                                    onTouchStart={(e) => handleTouchStart(e, item)}
                                                    onTouchMove={handleTouchMove}
                                                    className="drag-item bg-blue-500 text-white px-6 py-3 rounded-lg cursor-move hover:bg-blue-600 transition-colors font-medium"
                                                >
                                                    {item.text}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Action Buttons */}
                            <div className="flex justify-center gap-4 mt-8">
                                <button
                                    onClick={() => {
                                        setScreen('section_select');
                                        setCurrentSection(null);
                                    }}
                                    className="bg-gray-500 hover:bg-gray-600 text-white px-8 py-4 rounded-xl font-bold transition-all"
                                >
                                    <i className="fas fa-home mr-2"></i>
                                    ËøîÂõûÈÅ∏ÂñÆ
                                </button>
                                
                                {gameState === 'playing' && (
                                    <button
                                        onClick={checkAnswer}
                                        disabled={!allPlaced}
                                        className={`px-8 py-4 rounded-xl font-bold transition-all ${
                                            allPlaced 
                                                ? 'bg-green-500 hover:bg-green-600 text-white cursor-pointer' 
                                                : 'bg-gray-400 text-gray-200 cursor-not-allowed'
                                        }`}
                                    >
                                        <i className="fas fa-check mr-2"></i>
                                        {allPlaced ? 'Ê™¢Êü•Á≠îÊ°à' : `Â∞öÊú™ÂÆåÊàê (${placedItems}/${totalItems})`}
                                    </button>
                                )}
                                
                                {gameState === 'completed' && (
                                    <button
                                        onClick={nextLevel}
                                        className="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl font-bold transition-all"
                                    >
                                        <i className="fas fa-arrow-right mr-2"></i>
                                        {currentLevelIndex < totalLevels - 1 ? '‰∏ã‰∏ÄÈóú' : 'ÂÆåÊàêÂ∞èÁØÄ'}
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // ===========================================
            // RENDER: SECTION COMPLETE
            // ===========================================
            if (screen === 'section_complete') {
                const colors = themeColors[currentSection];
                const status = sectionCompletionStatus[currentSection];
                
                return (
                    <div className={`min-h-screen bg-gradient-to-br ${colors.primary} p-4 flex items-center justify-center`}>
                        <div className="max-w-2xl w-full">
                            <div id="section-certificate" className="bg-white rounded-3xl p-8 shadow-2xl">
                                <div className="text-center mb-6">
                                    <i className="fas fa-trophy text-6xl text-yellow-500 mb-4 float"></i>
                                    <h1 className="text-4xl font-black text-gray-800 mb-2">
                                        üéâ ÊÅ≠ÂñúÂÆåÊàêÔºÅ
                                    </h1>
                                    <p className="text-xl text-gray-600">
                                        ‰Ω†Â∑≤ÂÆåÊàê„Äå{currentSection}„ÄçÊâÄÊúâÈóúÂç°
                                    </p>
                                </div>
                                
                                <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6 mb-6">
                                    <div className="grid grid-cols-2 gap-4 text-center">
                                        <div>
                                            <div className="text-3xl font-bold text-blue-600">{status.totalTime}</div>
                                            <div className="text-gray-600">Á∏ΩÊôÇÈñìÔºàÁßíÔºâ</div>
                                        </div>
                                        <div>
                                            <div className="text-3xl font-bold text-green-600">{totalLevels}</div>
                                            <div className="text-gray-600">ÂÆåÊàêÈóúÂç°</div>
                                        </div>
                                        <div>
                                            <div className="text-3xl font-bold text-orange-600">{status.attempts}</div>
                                            <div className="text-gray-600">ÂòóË©¶Ê¨°Êï∏</div>
                                        </div>
                                        <div>
                                            <div className="text-3xl font-bold text-red-600">{status.errors}</div>
                                            <div className="text-gray-600">ÈåØË™§Ê¨°Êï∏</div>
                                        </div>
                                    </div>
                                </div>

                                {status.errorLog && status.errorLog.length > 0 && (
                                    <div className="bg-red-50 rounded-2xl p-6 mb-6">
                                        <h3 className="text-lg font-bold text-red-800 mb-3">
                                            <i className="fas fa-exclamation-triangle mr-2"></i>
                                            ÈåØË™§Ë®òÈåÑÔºà‰æõË§áÁøíÔºâ
                                        </h3>
                                        <div className="space-y-2 max-h-60 overflow-y-auto">
                                            {status.errorLog.map((error, index) => (
                                                <div key={index} className="bg-white p-3 rounded-lg text-sm">
                                                    <div className="font-bold text-gray-700">{error.levelTitle}</div>
                                                    <div className="text-red-600">‚úó ‰Ω†ÁöÑÁ≠îÊ°àÔºö{error.wrongAnswer}</div>
                                                    <div className="text-green-600">‚úì Ê≠£Á¢∫Á≠îÊ°àÔºö{error.correctAnswer}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                <div className="text-center text-sm text-gray-500">
                                    ÂÆåÊàêÊôÇÈñìÔºö{new Date(status.completedAt).toLocaleString('zh-TW')}
                                </div>
                            </div>
                            
                            <div className="flex justify-center gap-4 mt-6">
                                <button
                                    onClick={() => downloadCertificate('section-certificate', `Á¨¨6Á´†_${currentSection}_ÂÆåÊàêË≠âÊõ∏.png`)}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-bold transition-all"
                                >
                                    <i className="fas fa-download mr-2"></i>
                                    ‰∏ãËºâË≠âÊõ∏
                                </button>
                                <button
                                    onClick={() => setScreen('section_select')}
                                    className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-bold transition-all"
                                >
                                    <i className="fas fa-home mr-2"></i>
                                    ËøîÂõûÈÅ∏ÂñÆ
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // ===========================================
            // RENDER: ALL COMPLETE
            // ===========================================
            if (screen === 'all_complete') {
                const allErrorLogs = Object.keys(sectionCompletionStatus).reduce((acc, sectionId) => {
                    const status = sectionCompletionStatus[sectionId];
                    if (status.errorLog && status.errorLog.length > 0) {
                        acc[sectionId] = status.errorLog;
                    }
                    return acc;
                }, {});

                const totalErrors = Object.values(allErrorLogs).reduce((sum, logs) => sum + logs.length, 0);

                return (
                    <div className="min-h-screen bg-gradient-to-br from-yellow-400 via-orange-500 to-red-500 p-4 flex items-center justify-center">
                        <div className="max-w-3xl w-full">
                            <div id="all-complete-certificate" className="bg-white rounded-3xl p-8 shadow-2xl">
                                <div className="text-center mb-6">
                                    <i className="fas fa-medal text-8xl text-yellow-500 mb-4 float"></i>
                                    <h1 className="text-5xl font-black text-gray-800 mb-2">
                                        üèÜ ÂÖ®Á´†ÂÆåÊàêÔºÅ
                                    </h1>
                                    <p className="text-2xl text-gray-600 mb-4">
                                        ÊÅ≠Âñú‰Ω†ÂÆåÊàêÁ¨¨6Á´†ÊâÄÊúâÂ∞èÁØÄ
                                    </p>
                                    <div className="text-lg text-gray-500">
                                        Êé¢Á¥¢Áâ©Ë≥™ÁµÑÊàê
                                    </div>
                                </div>

                                <div className="grid grid-cols-4 gap-4 mb-6">
                                    {Object.keys(CHAPTER_DATA).map(sectionId => {
                                        const status = sectionCompletionStatus[sectionId];
                                        return (
                                            <div key={sectionId} className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-4 text-center">
                                                <div className="text-lg font-bold text-gray-800 mb-2">{sectionId}</div>
                                                <div className="text-sm text-gray-600">{status.totalTime}Áßí</div>
                                                <div className="text-sm text-gray-600">{status.errors}ÈåØ</div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {totalErrors > 0 && (
                                    <div className="bg-red-50 rounded-2xl p-6 mb-6">
                                        <h3 className="text-xl font-bold text-red-800 mb-4">
                                            <i className="fas fa-clipboard-list mr-2"></i>
                                            ÂÖ®Á´†ÈåØË™§Ë®òÈåÑÔºàÂÖ± {totalErrors} ÂÄãÈåØË™§Ôºâ
                                        </h3>
                                        <div className="space-y-4 max-h-96 overflow-y-auto">
                                            {Object.keys(allErrorLogs).map(sectionId => (
                                                <div key={sectionId}>
                                                    <div className="font-bold text-gray-700 mb-2">{sectionId}</div>
                                                    <div className="space-y-2">
                                                        {allErrorLogs[sectionId].map((error, index) => (
                                                            <div key={index} className="bg-white p-3 rounded-lg text-sm">
                                                                <div className="font-bold text-gray-600">{error.levelTitle}</div>
                                                                <div className="text-red-600">‚úó {error.wrongAnswer}</div>
                                                                <div className="text-green-600">‚úì {error.correctAnswer}</div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="text-center">
                                    <div className="text-2xl font-bold text-gray-800 mb-2">
                                        ‰Ω†ÊòØÂåñÂ≠∏Êé¢Á¥¢Â§ßÂ∏´ÔºÅ
                                    </div>
                                    <div className="text-gray-600">
                                        ÁπºÁ∫å‰øùÊåÅÂ≠∏ÁøíÁöÑÁÜ±ÊÉÖ üí™
                                    </div>
                                </div>
                            </div>

                            <div className="flex justify-center gap-4 mt-6">
                                <button
                                    onClick={() => downloadCertificate('all-complete-certificate', 'Á¨¨6Á´†_ÂÖ®Á´†ÂÆåÊàêË≠âÊõ∏.png')}
                                    className="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-xl font-bold transition-all text-lg"
                                >
                                    <i className="fas fa-download mr-2"></i>
                                    ‰∏ãËºâÂÆåÊàêË≠âÊõ∏
                                </button>
                                <button
                                    onClick={() => setScreen('section_select')}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-xl font-bold transition-all text-lg"
                                >
                                    <i className="fas fa-home mr-2"></i>
                                    ËøîÂõûÈÅ∏ÂñÆ
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        // ===========================================
        // RENDER TO DOM
        // ===========================================
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
