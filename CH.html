<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç«  æº«åº¦èˆ‡ç†± - äº’å‹•å¼é—–é—œç³»çµ±</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- html2canvas for screenshot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* ç¦ç”¨æ–‡å­—é¸å– */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* ç¦ç”¨æ–‡å­—æ¸¸æ¨™ */
            cursor: default;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            /* ç¦ç”¨ä¸‹æ‹‰åˆ·æ–° */
            overscroll-behavior: none;
            -webkit-user-select: none;
            user-select: none;
            overflow-x: hidden;
        }

        /* å…è¨±è¼¸å…¥æ¡†é¸å–ï¼ˆå¦‚æœæœªä¾†æœ‰çš„è©±ï¼‰ */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            cursor: text;
        }

        /* æŒ‰éˆ•ä¿æŒæŒ‡æ¨™æ¸¸æ¨™ */
        button, a, .clickable {
            cursor: pointer !important;
        }

        .drag-item {
            transition: all 0.2s ease;
            cursor: grab !important;
            /* æ‹–æ›³æ™‚ç¦ç”¨æ‰€æœ‰æ‰‹å‹¢ */
            -webkit-touch-callout: none;
        }

        .drag-item:active {
            cursor: grabbing !important;
        }

        @media (hover: hover) {
            .drag-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            }
        }

        /* è¡Œå‹•è£ç½®å°ˆç”¨ï¼šæ­£åœ¨æ‹–æ›³çš„é …ç›® */
        .dragging {
            opacity: 0.5;
            transform: scale(1.05);
            z-index: 1000;
            position: fixed;
            pointer-events: none;
        }

        /* å¯ç§»å‹•çš„é …ç›® */
        .cursor-move {
            cursor: move !important;
            -webkit-touch-callout: none;
        }

        .cursor-move:active {
            cursor: grabbing !important;
        }

        .drop-zone {
            transition: all 0.2s ease;
            min-height: 80px;
        }

        .drop-zone.drag-over {
            background: rgba(59, 130, 246, 0.2);
            border: 3px dashed #3b82f6 !important;
            transform: scale(1.02);
        }

        .formula-slot {
            transition: all 0.2s ease;
            min-height: 70px;
            min-width: 100px;
        }

        .formula-slot.drag-over {
            background: rgba(59, 130, 246, 0.3);
            border: 3px dashed #3b82f6 !important;
            transform: scale(1.05);
        }

        .correct-answer {
            animation: correctPulse 0.6s ease-out;
            border: 3px solid #10b981 !important;
            background: rgba(16, 185, 129, 0.1);
        }

        .wrong-answer {
            animation: shake 0.5s ease-out;
            border: 3px solid #ef4444 !important;
            background: rgba(239, 68, 68, 0.1);
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .formula-display {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===========================================
        // GAME DATA - æ‰€æœ‰é—œå¡æ•¸æ“š
        // ===========================================
        const CHAPTER_DATA = {
            "5-1": [
                {
                    id: "5-1-1",
                    section: "5-1",
                    type: "classification",
                    title: "ç¬¬ä¸€é—œï¼šæº«åº¦è¨ˆçš„åˆ†é¡",
                    description: "è«‹å°‡å„ç¨®æº«åº¦è¨ˆä¾æ“šå…¶æ¸¬é‡åŸç†åˆ†é¡",
                    zones: [
                        { id: 'zone1', title: 'ç†±è„¹å†·ç¸®åŸç†', icon: 'fa-ruler-vertical' },
                        { id: 'zone2', title: 'æ¶²æ™¶è®Šè‰²åŸç†', icon: 'fa-palette' },
                        { id: 'zone3', title: 'ç´…å¤–ç·šæ„Ÿæ¸¬åŸç†', icon: 'fa-radiation' }
                    ],
                    items: [
                        { id: 'item1', text: 'é…’ç²¾æº«åº¦è¨ˆ', val: 'thermal' },
                        { id: 'item2', text: 'æ°´éŠ€æº«åº¦è¨ˆ', val: 'thermal' },
                        { id: 'item3', text: 'æ¶²æ™¶æº«åº¦è¨ˆ', val: 'crystal' },
                        { id: 'item4', text: 'è€³æº«æ§', val: 'infrared' },
                        { id: 'item5', text: 'ç†±æˆåƒå„€', val: 'infrared' }
                    ],
                    solution: {
                        zone1: ['thermal'],
                        zone2: ['crystal'],
                        zone3: ['infrared']
                    }
                },
                {
                    id: "5-1-2",
                    section: "5-1",
                    type: "classification",
                    title: "ç¬¬äºŒé—œï¼šæº«æ¨™å°æ‡‰",
                    description: "è«‹å°‡å°æ‡‰çš„æº«åº¦é…å°ï¼ˆä¸€å¤§æ°£å£“ä¸‹ï¼‰",
                    zones: [
                        { id: 'zone1', title: 'æ”æ° 0â„ƒ', icon: 'fa-snowflake' },
                        { id: 'zone2', title: 'æ”æ° 100â„ƒ', icon: 'fa-fire' },
                        { id: 'zone3', title: 'æ”æ° 37â„ƒ', icon: 'fa-heart-pulse' }
                    ],
                    items: [
                        { id: 'item1', text: 'è¯æ° 32â„‰', val: 'ice' },
                        { id: 'item2', text: 'è¯æ° 212â„‰', val: 'boil' },
                        { id: 'item3', text: 'è¯æ° 98.6â„‰', val: 'body' },
                        { id: 'item4', text: 'æ°´çš„å†°é»', val: 'ice' },
                        { id: 'item5', text: 'æ°´çš„æ²¸é»', val: 'boil' },
                        { id: 'item6', text: 'äººé«”æ­£å¸¸é«”æº«', val: 'body' }
                    ],
                    solution: {
                        zone1: ['ice'],
                        zone2: ['boil'],
                        zone3: ['body']
                    }
                }
            ],
            "5-2": [
                {
                    id: "5-2-1",
                    section: "5-2",
                    type: "classification",
                    title: "ç¬¬ä¸€é—œï¼šç†±é‡å½±éŸ¿å› ç´ ",
                    description: "å°‡å½±éŸ¿ç‰©è³ªæº«åº¦è®ŠåŒ–çš„å› ç´ åˆ†é¡",
                    zones: [
                        { id: 'zone1', title: 'æº«åº¦è®ŠåŒ–è¶Šå¤§', icon: 'fa-arrow-up' },
                        { id: 'zone2', title: 'æº«åº¦è®ŠåŒ–è¶Šå°', icon: 'fa-arrow-down' }
                    ],
                    items: [
                        { id: 'item1', text: 'æä¾›ç†±é‡è¶Šå¤š', val: 'increase' },
                        { id: 'item2', text: 'ç‰©è³ªè³ªé‡è¶Šå¤§', val: 'decrease' },
                        { id: 'item3', text: 'ç‰©è³ªæ¯”ç†±è¶Šå¤§', val: 'decrease' },
                        { id: 'item4', text: 'åŠ ç†±æ™‚é–“è¶Šé•·', val: 'increase' },
                        { id: 'item5', text: 'ç‰©è³ªè³ªé‡è¶Šå°', val: 'increase' },
                        { id: 'item6', text: 'ç‰©è³ªæ¯”ç†±è¶Šå°', val: 'increase' }
                    ],
                    solution: {
                        zone1: ['increase'],
                        zone2: ['decrease']
                    }
                },
                {
                    id: "5-2-2",
                    section: "5-2",
                    type: "classification",
                    title: "ç¬¬äºŒé—œï¼šæ¯”ç†±çš„æ‡‰ç”¨",
                    description: "è«‹å°‡ä¸åŒæ‡‰ç”¨ä¾æ“šæ¯”ç†±ç‰¹æ€§åˆ†é¡",
                    zones: [
                        { id: 'zone1', title: 'åˆ©ç”¨æ°´æ¯”ç†±å¤§', icon: 'fa-droplet' },
                        { id: 'zone2', title: 'åˆ©ç”¨é‡‘å±¬æ¯”ç†±å°', icon: 'fa-medal' }
                    ],
                    items: [
                        { id: 'item1', text: 'æ±½è»Šå¼•æ“ç”¨æ°´å†·å»', val: 'water' },
                        { id: 'item2', text: 'è‡ªåŠ©é¤ç”¨ç†±æ°´ä¿æº«', val: 'water' },
                        { id: 'item3', text: 'é‡‘å±¬é‹å…·å¿«é€Ÿå°ç†±', val: 'metal' },
                        { id: 'item4', text: 'æµ·æ°´èª¿ç¯€æ²¿æµ·æ°£æº«', val: 'water' },
                        { id: 'item5', text: 'çƒ¤è‚‰æ’å…¥é‡‘å±¬ä¸²åŠ é€Ÿç†Ÿé€', val: 'metal' }
                    ],
                    solution: {
                        zone1: ['water'],
                        zone2: ['metal']
                    }
                },
                {
                    id: "5-2-3",
                    section: "5-2",
                    type: "classification",
                    title: "ç¬¬ä¸‰é—œï¼šç†±é‡å…¬å¼é…å°",
                    description: "æ ¹æ“šç†±é‡å…¬å¼ H = M Ã— S Ã— Î”Tï¼Œè«‹å°‡å„è®Šæ•¸èˆ‡å…¶æ„ç¾©é…å°",
                    zones: [
                        { id: 'zone1', title: 'Hï¼ˆç†±é‡ï¼‰', icon: 'fa-fire-flame-curved' },
                        { id: 'zone2', title: 'Mï¼ˆè³ªé‡ï¼‰', icon: 'fa-weight-scale' },
                        { id: 'zone3', title: 'Sï¼ˆæ¯”ç†±ï¼‰', icon: 'fa-temperature-half' },
                        { id: 'zone4', title: 'Î”Tï¼ˆæº«åº¦è®ŠåŒ–ï¼‰', icon: 'fa-chart-line' }
                    ],
                    items: [
                        { id: 'item1', text: 'å–®ä½ï¼šå¡ï¼ˆcalï¼‰', val: 'H' },
                        { id: 'item2', text: 'å–®ä½ï¼šå…¬å…‹ï¼ˆgï¼‰', val: 'M' },
                        { id: 'item3', text: 'å–®ä½ï¼šcal/(gÂ·â„ƒ)', val: 'S' },
                        { id: 'item4', text: 'å–®ä½ï¼šâ„ƒ', val: 'deltaT' },
                        { id: 'item5', text: 'ç‰©è³ªå¸æ”¶æˆ–æ”¾å‡ºçš„èƒ½é‡', val: 'H' },
                        { id: 'item6', text: 'ç‰©è³ªçš„å¤šå¯¡', val: 'M' },
                        { id: 'item7', text: 'ç‰©è³ªå‡é™1â„ƒæ‰€éœ€çš„ç†±é‡', val: 'S' },
                        { id: 'item8', text: 'æº«åº¦ä¸Šå‡æˆ–ä¸‹é™çš„åº¦æ•¸', val: 'deltaT' }
                    ],
                    solution: {
                        zone1: ['H'],
                        zone2: ['M'],
                        zone3: ['S'],
                        zone4: ['deltaT']
                    }
                },
                {
                    id: "5-2-4",
                    section: "5-2",
                    type: "formula_match",
                    title: "ç¬¬å››é—œï¼šç†±é‡å…¬å¼çµ„åˆèˆ‡é…å°",
                    description: "æ­¥é©Ÿ1ï¼šçµ„åˆå…¬å¼ H = M Ã— S Ã— Î”Tï¼Œæ­¥é©Ÿ2ï¼šé…å°ç¬¦è™Ÿèˆ‡ä¸­æ–‡æ„ç¾©",
                    formulaItems: [
                        { id: 'f1', text: 'H', val: 'H' },
                        { id: 'f2', text: 'M', val: 'M' },
                        { id: 'f3', text: 'S', val: 'S' },
                        { id: 'f4', text: 'Î”T', val: 'deltaT' }
                    ],
                    matchItems: [
                        { id: 'm1', text: 'ç†±é‡', val: 'H' },
                        { id: 'm2', text: 'è³ªé‡', val: 'M' },
                        { id: 'm3', text: 'æ¯”ç†±', val: 'S' },
                        { id: 'm4', text: 'æº«åº¦è®ŠåŒ–', val: 'deltaT' }
                    ],
                    zones: [
                        { id: 'zone1', title: 'H', icon: 'fa-fire-flame-curved' },
                        { id: 'zone2', title: 'M', icon: 'fa-weight-scale' },
                        { id: 'zone3', title: 'S', icon: 'fa-temperature-half' },
                        { id: 'zone4', title: 'Î”T', icon: 'fa-chart-line' }
                    ],
                    solution: {
                        formula: {
                            left: ['H'],
                            right: ['M', 'S', 'deltaT']
                        },
                        match: {
                            zone1: ['H'],
                            zone2: ['M'],
                            zone3: ['S'],
                            zone4: ['deltaT']
                        }
                    }
                }
            ],
            "5-3": [
                {
                    id: "5-3-1",
                    section: "5-3",
                    type: "classification",
                    title: "ç¬¬ä¸€é—œï¼šç‰©è³ªä¸‰æ…‹è®ŠåŒ–",
                    description: "è«‹å°‡ä¸åŒçš„ç‰©æ…‹è®ŠåŒ–éç¨‹åˆ†é¡",
                    zones: [
                        { id: 'zone1', title: 'å¸ç†±éç¨‹', icon: 'fa-fire-flame-curved' },
                        { id: 'zone2', title: 'æ”¾ç†±éç¨‹', icon: 'fa-snowflake' }
                    ],
                    items: [
                        { id: 'item1', text: 'ç†”åŒ–', val: 'absorb' },
                        { id: 'item2', text: 'å‡å›º', val: 'release' },
                        { id: 'item3', text: 'æ±½åŒ–', val: 'absorb' },
                        { id: 'item4', text: 'å‡çµ', val: 'release' },
                        { id: 'item5', text: 'æ˜‡è¯', val: 'absorb' },
                        { id: 'item6', text: 'å‡è¯', val: 'release' }
                    ],
                    solution: {
                        zone1: ['absorb'],
                        zone2: ['release']
                    }
                },
                {
                    id: "5-3-2",
                    section: "5-3",
                    type: "classification",
                    title: "ç¬¬äºŒé—œï¼šç”Ÿæ´»ä¸­çš„ä¸‰æ…‹è®ŠåŒ–",
                    description: "è«‹å°‡ç”Ÿæ´»ç¾è±¡å°æ‡‰åˆ°æ­£ç¢ºçš„ç‰©æ…‹è®ŠåŒ–",
                    zones: [
                        { id: 'zone1', title: 'ç†”åŒ–ç¾è±¡', icon: 'fa-ice-cream' },
                        { id: 'zone2', title: 'æ±½åŒ–ç¾è±¡', icon: 'fa-cloud' },
                        { id: 'zone3', title: 'å‡çµç¾è±¡', icon: 'fa-droplet' },
                        { id: 'zone4', title: 'æ˜‡è¯ç¾è±¡', icon: 'fa-smoke' }
                    ],
                    items: [
                        { id: 'item1', text: 'å†°æ£’èåŒ–', val: 'melt' },
                        { id: 'item2', text: 'æ°´ç…®æ²¸ç”¢ç”Ÿæ°´è’¸æ°£', val: 'vaporize' },
                        { id: 'item3', text: 'è¡£æœæ™¾ä¹¾', val: 'vaporize' },
                        { id: 'item4', text: 'çœ¼é¡èµ·éœ§', val: 'condense' },
                        { id: 'item5', text: 'ä¹¾å†°æ¶ˆå¤±', val: 'sublime' },
                        { id: 'item6', text: 'å†·é£²æ¯å¤–çš„æ°´ç ', val: 'condense' }
                    ],
                    solution: {
                        zone1: ['melt'],
                        zone2: ['vaporize'],
                        zone3: ['condense'],
                        zone4: ['sublime']
                    }
                },
                {
                    id: "5-3-3",
                    section: "5-3",
                    type: "classification",
                    title: "ç¬¬ä¸‰é—œï¼šç†±è„¹å†·ç¸®æ‡‰ç”¨",
                    description: "è«‹åˆ¤æ–·ä»¥ä¸‹è¨­è¨ˆæ˜¯åˆ©ç”¨ç†±è„¹å†·ç¸®çš„ä»€éº¼ç‰¹æ€§",
                    zones: [
                        { id: 'zone1', title: 'é¿å…å—ç†±è®Šå½¢', icon: 'fa-shield' },
                        { id: 'zone2', title: 'åˆ©ç”¨ç†±è„¹é–‹å•Ÿ', icon: 'fa-unlock' }
                    ],
                    items: [
                        { id: 'item1', text: 'éµè»Œé–“é ç•™ç©ºéš™', val: 'prevent' },
                        { id: 'item2', text: 'ç†±æ°´æ³¡é‡‘å±¬ç“¶è“‹', val: 'utilize' },
                        { id: 'item3', text: 'é›™å±¤ç»ç’ƒæ¯ç©ºæ°£å±¤', val: 'prevent' },
                        { id: 'item4', text: 'æ©‹æ¢ä¼¸ç¸®ç¸«è¨­è¨ˆ', val: 'prevent' }
                    ],
                    solution: {
                        zone1: ['prevent'],
                        zone2: ['utilize']
                    }
                }
            ],
            "5-4": [
                {
                    id: "5-4-1",
                    section: "5-4",
                    type: "classification",
                    title: "ç¬¬ä¸€é—œï¼šç†±å‚³æ’­æ–¹å¼",
                    description: "è«‹å°‡å„ç¨®ç†±å‚³æ’­ç¾è±¡åˆ†é¡åˆ°æ­£ç¢ºçš„æ–¹å¼",
                    zones: [
                        { id: 'zone1', title: 'å‚³å°', icon: 'fa-hand-fist' },
                        { id: 'zone2', title: 'å°æµ', icon: 'fa-wind' },
                        { id: 'zone3', title: 'è¼»å°„', icon: 'fa-sun' }
                    ],
                    items: [
                        { id: 'item1', text: 'é‡‘å±¬æ£’å‚³ç†±', val: 'conduction' },
                        { id: 'item2', text: 'ç†±æ°´ä¸Šå‡å†·æ°´ä¸‹æ²‰', val: 'convection' },
                        { id: 'item3', text: 'å¤ªé™½æº«æš–åœ°çƒ', val: 'radiation' },
                        { id: 'item4', text: 'é‹æŸ„è®Šç†±', val: 'conduction' },
                        { id: 'item5', text: 'æµ·é¢¨é™¸é¢¨å½¢æˆ', val: 'convection' },
                        { id: 'item6', text: 'æš–çˆç™¼å‡ºç†±', val: 'radiation' }
                    ],
                    solution: {
                        zone1: ['conduction'],
                        zone2: ['convection'],
                        zone3: ['radiation']
                    }
                },
                {
                    id: "5-4-2",
                    section: "5-4",
                    type: "classification",
                    title: "ç¬¬äºŒé—œï¼šå°ç†±æ€§è³ªåˆ†é¡",
                    description: "è«‹å°‡ä¸åŒæè³ªä¾æ“šå°ç†±æ€§åˆ†é¡",
                    zones: [
                        { id: 'zone1', title: 'ç†±çš„è‰¯å°é«”', icon: 'fa-fire' },
                        { id: 'zone2', title: 'ç†±çš„ä¸è‰¯å°é«”', icon: 'fa-ban' }
                    ],
                    items: [
                        { id: 'item1', text: 'éŠ…', val: 'good' },
                        { id: 'item2', text: 'éµ', val: 'good' },
                        { id: 'item3', text: 'æœ¨é ­', val: 'poor' },
                        { id: 'item4', text: 'å¡‘è† ', val: 'poor' },
                        { id: 'item5', text: 'ç©ºæ°£', val: 'poor' },
                        { id: 'item6', text: 'é‹', val: 'good' }
                    ],
                    solution: {
                        zone1: ['good'],
                        zone2: ['poor']
                    }
                },
                {
                    id: "5-4-3",
                    section: "5-4",
                    type: "classification",
                    title: "ç¬¬ä¸‰é—œï¼šè¼»å°„ç†±çš„æ‡‰ç”¨",
                    description: "è«‹å°‡ä»¥ä¸‹è¨­è¨ˆä¾æ“šæ˜¯å¦å®¹æ˜“å¸æ”¶è¼»å°„ç†±åˆ†é¡",
                    zones: [
                        { id: 'zone1', title: 'å®¹æ˜“å¸æ”¶è¼»å°„ç†±', icon: 'fa-circle' },
                        { id: 'zone2', title: 'ä¸æ˜“å¸æ”¶è¼»å°„ç†±', icon: 'fa-circle-notch' }
                    ],
                    items: [
                        { id: 'item1', text: 'å¤ªé™½èƒ½é›†ç†±æ¿ï¼ˆæ·±è‰²ï¼‰', val: 'absorb' },
                        { id: 'item2', text: 'æ°§æ°£å„²å­˜æ§½ï¼ˆç™½è‰²ï¼‰', val: 'reflect' },
                        { id: 'item3', text: 'é»‘è‰²æŸæ²¹è·¯', val: 'absorb' },
                        { id: 'item4', text: 'ç™½è‰²ç‰†å£', val: 'reflect' },
                        { id: 'item5', text: 'æ·±è‰²è¡£æœ', val: 'absorb' },
                        { id: 'item6', text: 'æ·ºè‰²è¡£æœ', val: 'reflect' }
                    ],
                    solution: {
                        zone1: ['absorb'],
                        zone2: ['reflect']
                    }
                }
            ]
        };

        // ä¸»é¡Œé…è‰²
        const themeColors = {
            '5-1': { 
                primary: 'from-orange-500 to-red-600',
                header: 'from-orange-600 to-red-700', 
                badge: 'bg-orange-500' 
            },
            '5-2': { 
                primary: 'from-blue-500 to-cyan-600',
                header: 'from-blue-600 to-cyan-700', 
                badge: 'bg-blue-500' 
            },
            '5-3': { 
                primary: 'from-purple-500 to-pink-600',
                header: 'from-purple-600 to-pink-700', 
                badge: 'bg-purple-500' 
            },
            '5-4': { 
                primary: 'from-green-500 to-teal-600',
                header: 'from-green-600 to-teal-700', 
                badge: 'bg-green-500' 
            }
        };

        // ===========================================
        // è¼”åŠ©å‡½æ•¸
        // ===========================================
        
        // éš¨æ©Ÿæ’åºå‡½æ•¸ï¼ˆFisher-Yates shuffleï¼‰
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // è§¸æ§æ‹–æ›³æ”¯æ´ - ç°¡åŒ–ç‰ˆ
        let touchDragData = null;
        let touchDragElement = null;
        let touchClone = null;
        let touchRemoveCallback = null;

        function handleTouchStart(e, item, removeCallback) {
            // å„²å­˜æ•¸æ“šä½†ä¸åšä»»ä½•è™•ç†
            touchDragData = item;
            touchDragElement = e.currentTarget;
            touchRemoveCallback = removeCallback;
            
            const touch = e.touches[0];
            
            // ç«‹å³å‰µå»ºè¦–è¦ºè¤‡è£½
            touchClone = touchDragElement.cloneNode(true);
            touchClone.style.position = 'fixed';
            touchClone.style.zIndex = '10000';
            touchClone.style.opacity = '0.8';
            touchClone.style.pointerEvents = 'none';
            touchClone.style.width = touchDragElement.offsetWidth + 'px';
            touchClone.style.left = (touch.clientX - touchDragElement.offsetWidth / 2) + 'px';
            touchClone.style.top = (touch.clientY - touchDragElement.offsetHeight / 2) + 'px';
            touchClone.style.transition = 'none';
            document.body.appendChild(touchClone);
            
            // åŸå…ƒç´ è®Šé€æ˜
            touchDragElement.style.opacity = '0.3';
            touchDragElement.style.transform = 'scale(0.95)';
            
            // åŸ·è¡Œç§»é™¤å›èª¿
            if (touchRemoveCallback) {
                setTimeout(touchRemoveCallback, 0);
            }
        }

        function handleTouchMove(e) {
            if (!touchClone) return;
            
            // é˜»æ­¢é é¢æ»¾å‹•å’Œä¸‹æ‹‰åˆ·æ–°
            e.preventDefault();
            
            const touch = e.touches[0];
            touchClone.style.left = (touch.clientX - touchClone.offsetWidth / 2) + 'px';
            touchClone.style.top = (touch.clientY - touchClone.offsetHeight / 2) + 'px';
            
            // é«˜äº®å¯æ”¾ç½®å€åŸŸ
            const dropZones = document.querySelectorAll('.drop-zone, .formula-slot');
            dropZones.forEach(zone => zone.classList.remove('drag-over'));
            
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            if (elementBelow) {
                const dropZone = elementBelow.closest('.drop-zone, .formula-slot');
                if (dropZone) {
                    dropZone.classList.add('drag-over');
                }
            }
        }

        function handleTouchEnd(e, dropCallback) {
            if (!touchClone) return;
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            
            // æ¸…é™¤è¦–è¦ºæ•ˆæœ
            if (touchClone && touchClone.parentNode) {
                touchClone.parentNode.removeChild(touchClone);
            }
            if (touchDragElement) {
                touchDragElement.style.opacity = '1';
                touchDragElement.style.transform = 'scale(1)';
            }
            
            // æ¸…é™¤é«˜äº®
            const dropZones = document.querySelectorAll('.drop-zone, .formula-slot');
            dropZones.forEach(zone => zone.classList.remove('drag-over'));
            
            // è™•ç†æ”¾ç½®
            if (elementBelow && touchDragData) {
                const dropZone = elementBelow.closest('.drop-zone, .formula-slot');
                if (dropZone && dropCallback) {
                    const zoneId = dropZone.getAttribute('data-zone-id');
                    if (zoneId) {
                        dropCallback(touchDragData, zoneId);
                    }
                }
            }
            
            // é‡ç½®
            touchDragData = null;
            touchDragElement = null;
            touchClone = null;
            touchRemoveCallback = null;
        }

        // ===========================================
        // ä¸»æ‡‰ç”¨ç¨‹å¼
        // ===========================================
        function App() {
            const [screen, setScreen] = useState('section_select');
            const [currentSection, setCurrentSection] = useState(null);
            const [currentLevelIndex, setCurrentLevelIndex] = useState(0);
            const [gameState, setGameState] = useState('playing');
            const [droppedItems, setDroppedItems] = useState({});
            const [formulaSlots, setFormulaSlots] = useState({ left: null, right1: null, right2: null, right3: null });
            const [matchZones, setMatchZones] = useState({});
            const [feedback, setFeedback] = useState({});
            const [startTime, setStartTime] = useState(null);
            const [elapsedTime, setElapsedTime] = useState(0);
            const [score, setScore] = useState({ correct: 0, total: 0 });
            const [shuffledItems, setShuffledItems] = useState([]);
            const [shuffledZones, setShuffledZones] = useState([]);
            
            // æ–°å¢ï¼šéŠæˆ²é€²åº¦è¿½è¹¤
            const [sectionStartTime, setSectionStartTime] = useState(null);
            const [sectionTotalTime, setSectionTotalTime] = useState(0);
            const [levelProgress, setLevelProgress] = useState({});
            const [errorLog, setErrorLog] = useState([]);
            const [completedLevels, setCompletedLevels] = useState([]);

            // è¨ˆæ™‚å™¨
            useEffect(() => {
                let timer;
                if (gameState === 'playing' && startTime) {
                    timer = setInterval(() => {
                        setElapsedTime(Math.floor((new Date() - startTime) / 1000));
                    }, 1000);
                }
                return () => {
                    if (timer) clearInterval(timer);
                };
            }, [gameState, startTime]);

            // åˆå§‹åŒ–é—œå¡ï¼ˆéš¨æ©Ÿæ’åºï¼‰
            const initializeLevel = (sectionId, levelIndex) => {
                const level = CHAPTER_DATA[sectionId][levelIndex];
                if (level.formulaItems) {
                    setShuffledItems(shuffleArray(level.formulaItems));
                } else if (level.items) {
                    setShuffledItems(shuffleArray(level.items));
                }
                if (level.zones) {
                    setShuffledZones(shuffleArray(level.zones));
                }
            };

            // é¸æ“‡å°ç¯€
            const selectSection = (sectionId) => {
                setCurrentSection(sectionId);
                setCurrentLevelIndex(0);
                setScreen('playing');
                setGameState('playing');
                setStartTime(new Date());
                setSectionStartTime(new Date());
                setElapsedTime(0);
                setDroppedItems({});
                setFormulaSlots({ left: null, right1: null, right2: null, right3: null });
                setMatchZones({});
                setFeedback({});
                setScore({ correct: 0, total: 0 });
                setLevelProgress({});
                setErrorLog([]);
                setCompletedLevels([]);
                initializeLevel(sectionId, 0);
            };

            // è™•ç†æ‹–æ›³
            const handleDragStart = (e, item) => {
                e.dataTransfer.setData('item', JSON.stringify(item));
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const handleDrop = (e, zoneId) => {
                e.preventDefault();
                const item = JSON.parse(e.dataTransfer.getData('item'));
                
                setDroppedItems(prev => ({
                    ...prev,
                    [zoneId]: [...(prev[zoneId] || []), item]
                }));
            };

            // è§¸æ§ç‰ˆæœ¬çš„æ”¾ç½®è™•ç†
            const handleTouchDrop = (item, zoneId) => {
                setDroppedItems(prev => ({
                    ...prev,
                    [zoneId]: [...(prev[zoneId] || []), item]
                }));
            };

            // è™•ç†é…å°å€æ‹–æ›³
            const handleMatchDrop = (e, zoneId) => {
                e.preventDefault();
                const item = JSON.parse(e.dataTransfer.getData('item'));
                
                setMatchZones(prev => ({
                    ...prev,
                    [zoneId]: [...(prev[zoneId] || []), item]
                }));
            };

            // è§¸æ§ç‰ˆæœ¬çš„é…å°å€æ”¾ç½®
            const handleTouchMatchDrop = (item, zoneId) => {
                setMatchZones(prev => ({
                    ...prev,
                    [zoneId]: [...(prev[zoneId] || []), item]
                }));
            };

            // è™•ç†å…¬å¼æ‹–æ›³
            const handleFormulaDrop = (e, slotId) => {
                e.preventDefault();
                const item = JSON.parse(e.dataTransfer.getData('item'));
                
                setFormulaSlots(prev => ({
                    ...prev,
                    [slotId]: item
                }));
            };

            // è§¸æ§ç‰ˆæœ¬çš„å…¬å¼æ”¾ç½®
            const handleTouchFormulaDrop = (item, slotId) => {
                setFormulaSlots(prev => ({
                    ...prev,
                    [slotId]: item
                }));
            };

            // ç§»é™¤å·²æ”¾ç½®çš„é …ç›®
            const removeItem = (zoneId, itemId) => {
                setDroppedItems(prev => ({
                    ...prev,
                    [zoneId]: prev[zoneId].filter(item => item.id !== itemId)
                }));
            };

            // ç§»é™¤é…å°å€çš„é …ç›®
            const removeMatchItem = (zoneId, itemId) => {
                setMatchZones(prev => ({
                    ...prev,
                    [zoneId]: prev[zoneId].filter(item => item.id !== itemId)
                }));
            };

            // ç§»é™¤å…¬å¼æ§½ä¸­çš„é …ç›®
            const removeFormulaItem = (slotId) => {
                setFormulaSlots(prev => ({
                    ...prev,
                    [slotId]: null
                }));
            };

            // æª¢æŸ¥ç­”æ¡ˆï¼ˆåˆ†é¡é¡Œï¼‰
            const checkClassificationAnswers = () => {
                const currentLevel = CHAPTER_DATA[currentSection][currentLevelIndex];
                const newFeedback = {};
                let correctCount = 0;
                let totalZones = Object.keys(currentLevel.solution).length;
                const wrongAnswers = [];

                Object.keys(currentLevel.solution).forEach(zoneId => {
                    const correctVals = currentLevel.solution[zoneId];
                    const droppedVals = (droppedItems[zoneId] || []).map(item => item.val);
                    
                    // æª¢æŸ¥ï¼šè©²å€åŸŸçš„æ‰€æœ‰é …ç›®çš„valéƒ½å¿…é ˆåœ¨æ­£ç¢ºç­”æ¡ˆä¸­
                    // ä¸”è©²å€åŸŸå¿…é ˆæœ‰é …ç›®ï¼ˆä¸èƒ½ç‚ºç©ºï¼‰
                    const isCorrect = droppedVals.length > 0 &&
                                    droppedVals.every(val => correctVals.includes(val));
                    
                    newFeedback[zoneId] = isCorrect;
                    if (isCorrect) {
                        correctCount++;
                    } else {
                        // è¨˜éŒ„éŒ¯èª¤
                        const zone = currentLevel.zones.find(z => z.id === zoneId);
                        wrongAnswers.push({
                            zone: zone.title,
                            userAnswer: (droppedItems[zoneId] || []).map(item => item.text),
                            correctAnswer: currentLevel.items
                                .filter(item => correctVals.includes(item.val))
                                .map(item => item.text)
                        });
                    }
                });

                // é¡å¤–æª¢æŸ¥ï¼šç¢ºä¿æ‰€æœ‰é …ç›®éƒ½å·²åˆ†é¡
                const allItemsPlaced = Object.values(droppedItems).flat().length === currentLevel.items.length;

                setFeedback(newFeedback);

                if (correctCount === totalZones && allItemsPlaced) {
                    // éé—œ
                    const levelTime = elapsedTime;
                    setCompletedLevels(prev => [...prev, {
                        levelId: currentLevel.id,
                        title: currentLevel.title,
                        time: levelTime,
                        attempts: score.total + 1
                    }]);
                    setGameState('completed');
                    setScore(prev => ({ 
                        correct: prev.correct + 1, 
                        total: prev.total + 1 
                    }));
                } else {
                    // ç­”éŒ¯
                    if (wrongAnswers.length > 0) {
                        setErrorLog(prev => [...prev, {
                            levelId: currentLevel.id,
                            levelTitle: currentLevel.title,
                            timestamp: new Date(),
                            errors: wrongAnswers
                        }]);
                    }
                    setScore(prev => ({ 
                        ...prev, 
                        total: prev.total + 1 
                    }));
                }
            };

            // æª¢æŸ¥ç­”æ¡ˆï¼ˆå…¬å¼é…å°é¡Œï¼‰
            const checkFormulaMatchAnswers = () => {
                const currentLevel = CHAPTER_DATA[currentSection][currentLevelIndex];
                const { left, right1, right2, right3 } = formulaSlots;
                
                // æª¢æŸ¥å…¬å¼çµ„åˆ
                const leftCorrect = left && left.val === currentLevel.solution.formula.left[0];
                const rightVals = [right1, right2, right3].filter(slot => slot !== null).map(slot => slot.val);
                const correctRight = currentLevel.solution.formula.right;
                const formulaCorrect = leftCorrect && rightVals.length === 3 &&
                                    correctRight.every(val => rightVals.includes(val)) &&
                                    rightVals.every(val => correctRight.includes(val));

                // æª¢æŸ¥é…å°
                const newFeedback = { formula: formulaCorrect };
                let matchCorrectCount = 0;
                const totalZones = Object.keys(currentLevel.solution.match).length;

                Object.keys(currentLevel.solution.match).forEach(zoneId => {
                    const correctVals = currentLevel.solution.match[zoneId];
                    const matchedVals = (matchZones[zoneId] || []).map(item => item.val);
                    
                    const isCorrect = matchedVals.length > 0 &&
                                    matchedVals.every(val => correctVals.includes(val));
                    
                    newFeedback[zoneId] = isCorrect;
                    if (isCorrect) matchCorrectCount++;
                });

                // æª¢æŸ¥æ‰€æœ‰é…å°é …ç›®éƒ½å·²ä½¿ç”¨
                const allMatchItemsPlaced = Object.values(matchZones).flat().length === currentLevel.matchItems.length;

                setFeedback(newFeedback);

                if (formulaCorrect && matchCorrectCount === totalZones && allMatchItemsPlaced) {
                    setGameState('completed');
                    setScore(prev => ({ 
                        correct: prev.correct + 1, 
                        total: prev.total + 1 
                    }));
                } else {
                    setScore(prev => ({ 
                        ...prev, 
                        total: prev.total + 1 
                    }));
                }
            };

            // æª¢æŸ¥ç­”æ¡ˆï¼ˆå…¬å¼é¡Œï¼‰
            const checkFormulaAnswers = () => {
                const currentLevel = CHAPTER_DATA[currentSection][currentLevelIndex];
                const { left, right1, right2, right3 } = formulaSlots;
                
                // æª¢æŸ¥å·¦é‚Š
                const leftCorrect = left && left.val === currentLevel.solution.left[0];
                
                // æª¢æŸ¥å³é‚Šï¼ˆé †åºä¸é™ï¼‰
                const rightVals = [right1, right2, right3].filter(slot => slot !== null).map(slot => slot.val);
                const correctRight = currentLevel.solution.right;
                const rightCorrect = rightVals.length === 3 &&
                                    correctRight.every(val => rightVals.includes(val)) &&
                                    rightVals.every(val => correctRight.includes(val));

                const newFeedback = {
                    left: leftCorrect,
                    right: rightCorrect
                };

                setFeedback(newFeedback);

                if (leftCorrect && rightCorrect) {
                    setGameState('completed');
                    setScore(prev => ({ 
                        correct: prev.correct + 1, 
                        total: prev.total + 1 
                    }));
                } else {
                    setScore(prev => ({ 
                        ...prev, 
                        total: prev.total + 1 
                    }));
                }
            };

            // æª¢æŸ¥ç­”æ¡ˆçµ±ä¸€æ¥å£
            const checkAnswers = () => {
                const currentLevel = CHAPTER_DATA[currentSection][currentLevelIndex];
                if (currentLevel.type === 'formula_match') {
                    checkFormulaMatchAnswers();
                } else if (currentLevel.type === 'formula') {
                    checkFormulaAnswers();
                } else {
                    checkClassificationAnswers();
                }
            };

            // ä¸‹ä¸€é—œ
            const nextLevel = () => {
                if (currentLevelIndex < CHAPTER_DATA[currentSection].length - 1) {
                    const newIndex = currentLevelIndex + 1;
                    setCurrentLevelIndex(newIndex);
                    setGameState('playing');
                    setStartTime(new Date());
                    setElapsedTime(0);
                    setDroppedItems({});
                    setFormulaSlots({ left: null, right1: null, right2: null, right3: null });
                    setMatchZones({});
                    setFeedback({});
                    initializeLevel(currentSection, newIndex);
                } else {
                    // å®Œæˆæ‰€æœ‰é—œå¡ï¼Œè¨ˆç®—ç¸½æ™‚é–“
                    const endTime = new Date();
                    const totalSeconds = Math.floor((endTime - sectionStartTime) / 1000);
                    setSectionTotalTime(totalSeconds);
                    setScreen('final_summary');
                }
            };

            // é‡æ–°é–‹å§‹
            const restart = () => {
                setCurrentLevelIndex(0);
                setGameState('playing');
                setStartTime(new Date());
                setElapsedTime(0);
                setDroppedItems({});
                setFormulaSlots({ left: null, right1: null, right2: null, right3: null });
                setMatchZones({});
                setFeedback({});
                setScore({ correct: 0, total: 0 });
                initializeLevel(currentSection, 0);
            };

            // æ ¼å¼åŒ–æ™‚é–“
            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            // å–å¾—ç•¶å‰é—œå¡
            const currentLevel = currentSection ? CHAPTER_DATA[currentSection][currentLevelIndex] : null;
            const colors = currentSection ? themeColors[currentSection] : themeColors['5-1'];

            // ===========================================
            // å°ç¯€é¸æ“‡ç•«é¢
            // ===========================================
            if (screen === 'section_select') {
                const sections = [
                    { id: '5-1', title: '5-1 æº«åº¦èˆ‡æº«åº¦è¨ˆ', icon: 'fa-thermometer-half', levels: 2, color: 'from-orange-400 to-red-600' },
                    { id: '5-2', title: '5-2 ç†±é‡èˆ‡æ¯”ç†±', icon: 'fa-fire', levels: 4, color: 'from-blue-400 to-cyan-600' },
                    { id: '5-3', title: '5-3 ç†±å°ç‰©è³ªçš„å½±éŸ¿', icon: 'fa-water', levels: 3, color: 'from-purple-400 to-pink-600' },
                    { id: '5-4', title: '5-4 ç†±çš„å‚³æ’­æ–¹å¼', icon: 'fa-sun', levels: 3, color: 'from-green-400 to-teal-600' }
                ];

                return (
                    <div className="min-h-screen flex items-center justify-center p-6">
                        <div className="max-w-6xl w-full">
                            <div className="text-center mb-12 fade-in">
                                <h1 className="text-5xl font-black text-white mb-4">
                                    <i className="fas fa-temperature-high mr-4"></i>
                                    ç¬¬5ç«  æº«åº¦èˆ‡ç†±
                                </h1>
                                <p className="text-xl text-white/90">é¸æ“‡ä¸€å€‹å°ç¯€é–‹å§‹å­¸ç¿’</p>
                            </div>

                            <div className="grid md:grid-cols-2 gap-6">
                                {sections.map((section, index) => (
                                    <div
                                        key={section.id}
                                        className="glass-effect rounded-2xl p-8 hover:scale-105 transition-all duration-300 cursor-pointer fade-in"
                                        style={{ animationDelay: `${index * 0.1}s` }}
                                        onClick={() => selectSection(section.id)}
                                    >
                                        <div className={`w-20 h-20 bg-gradient-to-br ${section.color} rounded-2xl flex items-center justify-center mb-6 mx-auto`}>
                                            <i className={`${section.icon} text-4xl text-white`}></i>
                                        </div>
                                        <h2 className="text-2xl font-bold text-white text-center mb-3">
                                            {section.title}
                                        </h2>
                                        <p className="text-white/80 text-center">
                                            å…± {section.levels} å€‹é—œå¡
                                        </p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // ===========================================
            // éŠæˆ²é€²è¡Œç•«é¢
            // ===========================================
            if (screen === 'playing' && currentLevel) {
                // å–å¾—é‚„æ²’è¢«æ”¾ç½®çš„é …ç›®
                let availableItems = [];
                
                if (currentLevel.type === 'formula_match') {
                    const placedVals = Object.values(formulaSlots).filter(slot => slot !== null).map(slot => slot.val);
                    availableItems = shuffledItems.filter(item => !placedVals.includes(item.val));
                } else if (currentLevel.type === 'formula') {
                    const placedVals = Object.values(formulaSlots).filter(slot => slot !== null).map(slot => slot.val);
                    availableItems = shuffledItems.filter(item => !placedVals.includes(item.val));
                } else {
                    const placedItemIds = Object.values(droppedItems).flat().map(item => item.id);
                    availableItems = shuffledItems.filter(item => !placedItemIds.includes(item.id));
                }

                return (
                    <div className="h-screen flex flex-col overflow-hidden">
                        {/* é é¦– - å›ºå®šåœ¨é ‚éƒ¨ */}
                        <div className={`flex-shrink-0 bg-gradient-to-r ${colors.header} p-3 text-white shadow-xl`}>
                            {/* é—œå¡é€²åº¦æ¢ - ç²¾ç°¡ç‰ˆ */}
                            <div className="mb-2">
                                <div className="flex items-center justify-between mb-1.5">
                                    <span className="text-xs font-bold opacity-90">ğŸ® {currentLevelIndex + 1}/{CHAPTER_DATA[currentSection].length}</span>
                                    <div className="flex items-center gap-3">
                                        <span className="text-xs opacity-80">â±ï¸ {formatTime(elapsedTime)}</span>
                                        <span className="text-xs bg-black/20 px-2 py-0.5 rounded">ğŸ¯ {score.total}æ¬¡</span>
                                    </div>
                                </div>
                                {/* é€²åº¦æ¢ */}
                                <div className="relative h-4 bg-black/30 rounded-full overflow-hidden mb-1.5">
                                    <div 
                                        className="absolute h-full bg-gradient-to-r from-yellow-400 to-yellow-600 transition-all duration-500"
                                        style={{ width: `${((currentLevelIndex + 1) / CHAPTER_DATA[currentSection].length) * 100}%` }}
                                    ></div>
                                </div>
                                {/* é—œå¡ç‹€æ…‹é» - æ©«å‘ç·Šæ¹Š */}
                                <div className="flex gap-1.5 justify-center">
                                    {CHAPTER_DATA[currentSection].map((level, idx) => (
                                        <div 
                                            key={idx}
                                            className={`
                                                w-6 h-6 rounded flex items-center justify-center text-xs font-bold transition-all
                                                ${idx < currentLevelIndex ? 'bg-green-500 text-white' : ''}
                                                ${idx === currentLevelIndex ? 'bg-yellow-400 text-black animate-pulse' : ''}
                                                ${idx > currentLevelIndex ? 'bg-gray-500/30 text-gray-400' : ''}
                                            `}
                                        >
                                            {idx < currentLevelIndex ? 'âœ“' : idx + 1}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            {/* æ¨™é¡Œèˆ‡æŒ‰éˆ• - ç²¾ç°¡ç‰ˆ */}
                            <div className="flex justify-between items-center gap-2">
                                <div className="flex-1 min-w-0">
                                    <h2 className="text-base md:text-lg font-bold truncate">{currentLevel.title}</h2>
                                    <p className="text-white/80 text-xs truncate hidden md:block">{currentLevel.description}</p>
                                </div>
                                <button
                                    onClick={() => setScreen('section_select')}
                                    className="bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded-lg transition-all text-xs flex-shrink-0"
                                >
                                    <i className="fas fa-home"></i>
                                    <span className="ml-1 hidden sm:inline">è¿”å›</span>
                                </button>
                            </div>
                        </div>

                        {/* éŠæˆ²å…§å®¹å€ - å¯æ»¾å‹• */}
                        <div className="flex-1 overflow-y-auto p-3 md:p-6" style={{WebkitOverflowScrolling: 'touch'}}>
                        
                        {/* åˆ†é¡é¡Œå‹ */}
                        {currentLevel.type === 'classification' && (
                            <div className="grid lg:grid-cols-3 gap-3">
                                {/* é¸é …å€ */}
                                <div className="lg:col-span-1">
                                    <div className="glass-effect rounded-xl p-3 md:p-4 lg:sticky lg:top-20">
                                        <h3 className="text-base md:text-xl font-bold text-white mb-3 flex items-center">
                                            <i className="fas fa-cube mr-2 text-sm"></i>
                                            å¾…åˆ†é¡é …ç›®
                                        </h3>
                                        <div className="space-y-2">
                                            {availableItems.map(item => (
                                                <div
                                                    key={item.id}
                                                    draggable
                                                    onDragStart={(e) => handleDragStart(e, item)}
                                                    onTouchStart={(e) => handleTouchStart(e, item, null)}
                                                    onTouchMove={handleTouchMove}
                                                    onTouchEnd={(e) => handleTouchEnd(e, handleTouchDrop)}
                                                    className="drag-item bg-white rounded-lg p-3 shadow-lg"
                                                >
                                                    <p className="text-gray-800 font-medium text-center text-sm md:text-base">
                                                        {item.text}
                                                    </p>
                                                </div>
                                            ))}
                                            {availableItems.length === 0 && (
                                                <div className="text-center text-white/70 py-4 text-sm">
                                                    æ‰€æœ‰é …ç›®éƒ½å·²åˆ†é¡
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* åˆ†é¡å€ */}
                                <div className="lg:col-span-2">
                                    <div className="grid gap-3">
                                        {shuffledZones.map(zone => (
                                            <div
                                                key={zone.id}
                                                data-zone-id={zone.id}
                                                onDragOver={handleDragOver}
                                                onDrop={(e) => handleDrop(e, zone.id)}
                                                className={`
                                                    drop-zone glass-effect rounded-xl p-3 md:p-4
                                                    ${feedback[zone.id] === true ? 'correct-answer' : ''}
                                                    ${feedback[zone.id] === false ? 'wrong-answer' : ''}
                                                    ${!feedback[zone.id] ? 'border-2 border-white/30' : ''}
                                                `}
                                            >
                                                <h4 className="text-base md:text-lg font-bold text-white mb-2 md:mb-3 flex items-center">
                                                    <i className={`${zone.icon} mr-2 text-sm`}></i>
                                                    <span className="flex-1">{zone.title}</span>
                                                    {feedback[zone.id] === true && (
                                                        <i className="fas fa-check-circle text-green-400 text-lg md:text-xl"></i>
                                                    )}
                                                    {feedback[zone.id] === false && (
                                                        <i className="fas fa-times-circle text-red-400 text-lg md:text-xl"></i>
                                                    )}
                                                </h4>
                                                <div className="grid grid-cols-2 gap-2">
                                                    {(droppedItems[zone.id] || []).map(item => (
                                                        <div
                                                            key={item.id}
                                                            draggable
                                                            onDragStart={(e) => {
                                                                handleDragStart(e, item);
                                                                // å¾åŸä½ç½®ç§»é™¤
                                                                setTimeout(() => removeItem(zone.id, item.id), 0);
                                                            }}
                                                            onTouchStart={(e) => handleTouchStart(e, item, () => removeItem(zone.id, item.id))}
                                                            onTouchMove={handleTouchMove}
                                                            onTouchEnd={(e) => handleTouchEnd(e, handleTouchDrop)}
                                                            className="bg-white rounded-lg p-2 md:p-3 shadow-lg group relative cursor-move"
                                                        >
                                                            <p className="text-gray-800 font-medium text-xs md:text-sm text-center pr-6">
                                                                {item.text}
                                                            </p>
                                                            <button
                                                                onClick={() => removeItem(zone.id, item.id)}
                                                                className="absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-xs"
                                                            >
                                                                Ã—
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* æª¢æŸ¥ç­”æ¡ˆæŒ‰éˆ• */}
                                    <div className="mt-3 flex gap-2 md:gap-3">
                                        {gameState === 'playing' && (
                                            <button
                                                onClick={checkAnswers}
                                                className="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 md:py-3.5 rounded-lg md:rounded-xl font-bold text-sm md:text-base hover:scale-105 transition-all shadow-xl"
                                                disabled={Object.values(droppedItems).flat().length === 0}
                                            >
                                                <i className="fas fa-check mr-1 md:mr-2"></i>
                                                æª¢æŸ¥ç­”æ¡ˆ
                                            </button>
                                        )}
                                        {gameState === 'completed' && (
                                            <button
                                                onClick={nextLevel}
                                                className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 md:py-3.5 rounded-lg md:rounded-xl font-bold text-sm md:text-base hover:scale-105 transition-all shadow-xl"
                                            >
                                                <i className="fas fa-arrow-right mr-1 md:mr-2"></i>
                                                {currentLevelIndex < CHAPTER_DATA[currentSection].length - 1 ? 'ä¸‹ä¸€é—œ' : 'å®Œæˆæœ¬ç¯€'}
                                            </button>
                                        )}
                                        <button
                                            onClick={restart}
                                            className="bg-white/20 text-white px-4 md:px-5 py-3 md:py-3.5 rounded-lg md:rounded-xl hover:bg-white/30 transition-all text-sm md:text-base"
                                        >
                                            <i className="fas fa-redo mr-1 md:mr-2"></i>
                                            <span className="hidden sm:inline">é‡æ–°é–‹å§‹</span>
                                            <span className="sm:hidden">é‡ä¾†</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* å…¬å¼é…å°é¡Œå‹ */}
                        {currentLevel.type === 'formula_match' && (
                            <div className="max-w-5xl mx-auto">
                                {/* å…¬å¼å€åŸŸ */}
                                <div className="glass-effect rounded-xl p-4 md:p-6 mb-3">
                                    <div className="formula-display justify-center text-white mb-4 md:mb-6">
                                        {/* å·¦é‚Š */}
                                        <div
                                            data-zone-id="left"
                                            onDragOver={handleDragOver}
                                            onDrop={(e) => handleFormulaDrop(e, 'left')}
                                            className={`
                                                formula-slot border-4 rounded-xl flex items-center justify-center
                                                ${feedback.formula === true ? 'correct-answer border-green-400' : ''}
                                                ${feedback.formula === false ? 'wrong-answer border-red-400' : ''}
                                                ${feedback.formula === undefined ? 'border-white/50 border-dashed' : ''}
                                            `}
                                        >
                                            {formulaSlots.left ? (
                                                <div className="relative group">
                                                    <div className="text-center">
                                                        <div className="text-3xl font-bold">{formulaSlots.left.text}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeFormulaItem('left')}
                                                        className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-xs"
                                                    >
                                                        Ã—
                                                    </button>
                                                </div>
                                            ) : (
                                                <span className="text-white/40 text-xl">æ‹–æ›³åˆ°æ­¤</span>
                                            )}
                                        </div>

                                        <span className="text-4xl">=</span>

                                        {/* å³é‚Š1 */}
                                        <div
                                            data-zone-id="right1"
                                            onDragOver={handleDragOver}
                                            onDrop={(e) => handleFormulaDrop(e, 'right1')}
                                            className={`
                                                formula-slot border-4 rounded-xl flex items-center justify-center
                                                ${feedback.formula === true ? 'correct-answer border-green-400' : ''}
                                                ${feedback.formula === false ? 'wrong-answer border-red-400' : ''}
                                                ${feedback.formula === undefined ? 'border-white/50 border-dashed' : ''}
                                            `}
                                        >
                                            {formulaSlots.right1 ? (
                                                <div className="relative group">
                                                    <div className="text-center">
                                                        <div className="text-3xl font-bold">{formulaSlots.right1.text}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeFormulaItem('right1')}
                                                        className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-xs"
                                                    >
                                                        Ã—
                                                    </button>
                                                </div>
                                            ) : (
                                                <span className="text-white/40 text-xl">æ‹–æ›³åˆ°æ­¤</span>
                                            )}
                                        </div>

                                        <span className="text-4xl">Ã—</span>

                                        {/* å³é‚Š2 */}
                                        <div
                                            data-zone-id="right2"
                                            onDragOver={handleDragOver}
                                            onDrop={(e) => handleFormulaDrop(e, 'right2')}
                                            className={`
                                                formula-slot border-4 rounded-xl flex items-center justify-center
                                                ${feedback.formula === true ? 'correct-answer border-green-400' : ''}
                                                ${feedback.formula === false ? 'wrong-answer border-red-400' : ''}
                                                ${feedback.formula === undefined ? 'border-white/50 border-dashed' : ''}
                                            `}
                                        >
                                            {formulaSlots.right2 ? (
                                                <div className="relative group">
                                                    <div className="text-center">
                                                        <div className="text-3xl font-bold">{formulaSlots.right2.text}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeFormulaItem('right2')}
                                                        className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-xs"
                                                    >
                                                        Ã—
                                                    </button>
                                                </div>
                                            ) : (
                                                <span className="text-white/40 text-xl">æ‹–æ›³åˆ°æ­¤</span>
                                            )}
                                        </div>

                                        <span className="text-4xl">Ã—</span>

                                        {/* å³é‚Š3 */}
                                        <div
                                            data-zone-id="right3"
                                            onDragOver={handleDragOver}
                                            onDrop={(e) => handleFormulaDrop(e, 'right3')}
                                            className={`
                                                formula-slot border-4 rounded-xl flex items-center justify-center
                                                ${feedback.formula === true ? 'correct-answer border-green-400' : ''}
                                                ${feedback.formula === false ? 'wrong-answer border-red-400' : ''}
                                                ${feedback.formula === undefined ? 'border-white/50 border-dashed' : ''}
                                            `}
                                        >
                                            {formulaSlots.right3 ? (
                                                <div className="relative group">
                                                    <div className="text-center">
                                                        <div className="text-3xl font-bold">{formulaSlots.right3.text}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeFormulaItem('right3')}
                                                        className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity text-xs"
                                                    >
                                                        Ã—
                                                    </button>
                                                </div>
                                            ) : (
                                                <span className="text-white/40 text-xl">æ‹–æ›³åˆ°æ­¤</span>
                                            )}
                                        </div>
                                    </div>

                                    {/* æç¤º */}
                                    <div className="text-center text-white/70 text-sm">
                                        ğŸ’¡ æç¤ºï¼šå³é‚Šä¸‰å€‹è®Šæ•¸çš„é †åºå¯ä»¥ä»»æ„æ’åˆ—
                                    </div>
                                </div>

                                {/* é…å°å€åŸŸ */}
                                <div className="glass-effect rounded-2xl p-8 mb-6">
                                    <h3 className="text-2xl font-bold text-white mb-6 text-center">
                                        <i className="fas fa-link mr-3"></i>
                                        æ­¥é©Ÿ2ï¼šé…å°ç¬¦è™Ÿèˆ‡ä¸­æ–‡æ„ç¾©
                                    </h3>
                                    <div className="grid grid-cols-4 gap-4">
                                        {shuffledZones.map(zone => (
                                            <div key={zone.id} className="flex flex-col gap-2">
                                                {/* ç¬¦è™Ÿæ¨™é¡Œ */}
                                                <div className="bg-white/20 rounded-xl p-4 text-center">
                                                    <div className="text-3xl font-bold text-white mb-1">{zone.title}</div>
                                                    <i className={`${zone.icon} text-white/70 text-sm`}></i>
                                                </div>
                                                {/* é…å°æ‹–æ”¾å€ */}
                                                <div
                                                    data-zone-id={zone.id}
                                                    onDragOver={handleDragOver}
                                                    onDrop={(e) => handleMatchDrop(e, zone.id)}
                                                    className={`
                                                        drop-zone rounded-xl p-4 min-h-[80px] flex items-center justify-center
                                                        ${feedback[zone.id] === true ? 'correct-answer' : ''}
                                                        ${feedback[zone.id] === false ? 'wrong-answer' : ''}
                                                        ${!feedback[zone.id] ? 'border-2 border-white/30 border-dashed' : ''}
                                                    `}
                                                >
                                                    {(matchZones[zone.id] || []).length > 0 ? (
                                                        <div className="w-full">
                                                            {matchZones[zone.id].map(item => (
                                                                <div
                                                                    key={item.id}
                                                                    draggable
                                                                    onDragStart={(e) => {
                                                                        handleDragStart(e, item);
                                                                        // å¾åŸä½ç½®ç§»é™¤
                                                                        setTimeout(() => removeMatchItem(zone.id, item.id), 0);
                                                                    }}
                                                                    onTouchStart={(e) => handleTouchStart(e, item, () => removeMatchItem(zone.id, item.id))}
                                                                    onTouchMove={handleTouchMove}
                                                                    onTouchEnd={(e) => handleTouchEnd(e, handleTouchMatchDrop)}
                                                                    className="bg-white rounded-lg p-3 shadow-lg group relative cursor-move"
                                                                >
                                                                    <p className="text-gray-800 font-medium text-center pr-6">
                                                                        {item.text}
                                                                    </p>
                                                                    <button
                                                                        onClick={() => removeMatchItem(zone.id, item.id)}
                                                                        className="absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-xs"
                                                                    >
                                                                        Ã—
                                                                    </button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    ) : (
                                                        <span className="text-white/40 text-sm">æ‹–æ›³ä¸­æ–‡åˆ°æ­¤</span>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* é¸é …å€ */}
                                <div className="glass-effect rounded-xl p-3 md:p-4 mb-3">
                                    <h3 className="text-base md:text-lg font-bold text-white mb-3 text-center">
                                        <i className="fas fa-cube mr-2 text-sm"></i>
                                        å¯ç”¨é¸é …
                                    </h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        {/* å·¦å´ï¼šå…¬å¼è®Šæ•¸ */}
                                        <div>
                                            <p className="text-white/80 text-xs mb-2 text-center">æ­¥é©Ÿ1ï¼šçµ„åˆå…¬å¼çš„è®Šæ•¸</p>
                                            <div className="flex justify-center gap-2 flex-wrap">
                                                {availableItems.map(item => (
                                                    <div
                                                        key={item.id}
                                                        draggable
                                                        onDragStart={(e) => handleDragStart(e, item)}
                                                        onTouchStart={(e) => handleTouchStart(e, item, null)}
                                                        onTouchMove={handleTouchMove}
                                                        onTouchEnd={(e) => handleTouchEnd(e, handleTouchFormulaDrop)}
                                                        className="drag-item bg-white rounded-lg p-3 shadow-lg"
                                                    >
                                                        <p className="text-gray-800 font-bold text-xl md:text-2xl text-center">
                                                            {item.text}
                                                        </p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        {/* å³å´ï¼šä¸­æ–‡æ„ç¾© */}
                                        <div>
                                            <p className="text-white/80 text-xs mb-2 text-center">æ­¥é©Ÿ2ï¼šé…å°çš„ä¸­æ–‡æ„ç¾©</p>
                                            <div className="flex justify-center gap-2 flex-wrap">
                                                {(() => {
                                                    const placedMatchIds = Object.values(matchZones).flat().map(item => item.id);
                                                    return currentLevel.matchItems.filter(item => !placedMatchIds.includes(item.id)).map(item => (
                                                        <div
                                                            key={item.id}
                                                            draggable
                                                            onDragStart={(e) => handleDragStart(e, item)}
                                                            onTouchStart={(e) => handleTouchStart(e, item, null)}
                                                            onTouchMove={handleTouchMove}
                                                            onTouchEnd={(e) => handleTouchEnd(e, handleTouchMatchDrop)}
                                                            className="drag-item bg-white rounded-lg p-3 shadow-lg"
                                                        >
                                                            <p className="text-gray-800 font-medium text-center text-sm md:text-base">
                                                                {item.text}
                                                            </p>
                                                        </div>
                                                    ));
                                                })()}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* æª¢æŸ¥ç­”æ¡ˆæŒ‰éˆ• */}
                                <div className="flex gap-4">
                                    {gameState === 'playing' && (
                                        <button
                                            onClick={checkAnswers}
                                            className="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-xl font-bold text-lg hover:scale-105 transition-all shadow-xl"
                                            disabled={
                                                !formulaSlots.left || 
                                                !formulaSlots.right1 || 
                                                !formulaSlots.right2 || 
                                                !formulaSlots.right3 ||
                                                Object.values(matchZones).flat().length === 0
                                            }
                                        >
                                            <i className="fas fa-check mr-2"></i>
                                            æª¢æŸ¥ç­”æ¡ˆ
                                        </button>
                                    )}
                                    {gameState === 'completed' && (
                                        <button
                                            onClick={nextLevel}
                                            className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:scale-105 transition-all shadow-xl"
                                        >
                                            <i className="fas fa-arrow-right mr-2"></i>
                                            {currentLevelIndex < CHAPTER_DATA[currentSection].length - 1 ? 'ä¸‹ä¸€é—œ' : 'å®Œæˆæœ¬ç¯€'}
                                        </button>
                                    )}
                                    <button
                                        onClick={restart}
                                        className="bg-white/20 text-white px-6 py-4 rounded-xl hover:bg-white/30 transition-all"
                                    >
                                        <i className="fas fa-redo mr-2"></i>
                                        é‡æ–°é–‹å§‹
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        </div>
                        {/* éŠæˆ²å…§å®¹å€çµæŸ */}
                    </div>
                );
            }

            // ===========================================
            // æœ€çµ‚ç¸½çµç•«é¢
            // ===========================================
            if (screen === 'final_summary') {
                const completionDate = new Date();
                const errorCount = errorLog.length;
                const totalAttempts = score.total;
                const correctAttempts = score.correct;
                const wrongAttempts = totalAttempts - correctAttempts;
                
                // æˆªåœ–åŠŸèƒ½
                const takeScreenshot = () => {
                    const element = document.getElementById('summary-content');
                    html2canvas(element, {
                        backgroundColor: '#667eea',
                        scale: 2
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `ç¬¬5ç« -${currentSection}-å­¸ç¿’æˆæœ-${completionDate.getFullYear()}${(completionDate.getMonth()+1).toString().padStart(2,'0')}${completionDate.getDate().toString().padStart(2,'0')}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                    });
                };
                
                return (
                    <div className="min-h-screen p-6">
                        <div id="summary-content" className="max-w-5xl mx-auto">
                            {/* æ¨™é¡Œå€ */}
                            <div className="glass-effect rounded-3xl p-8 mb-6 text-center fade-in">
                                <div className="text-6xl mb-4">ğŸ†</div>
                                <h1 className="text-5xl font-black text-white mb-2">
                                    æŒ‘æˆ°å®Œæˆï¼
                                </h1>
                                <p className="text-2xl text-white/90">
                                    {currentSection} å…¨é—œå¡é€šé—œ
                                </p>
                            </div>

                            {/* åŸºæœ¬çµ±è¨ˆ */}
                            <div className="grid md:grid-cols-4 gap-4 mb-6">
                                <div className="glass-effect rounded-2xl p-6 text-center">
                                    <div className="text-4xl mb-2">ğŸ“…</div>
                                    <div className="text-white/80 text-sm mb-1">å®Œæˆæ™‚é–“</div>
                                    <div className="text-white font-bold">
                                        {completionDate.getFullYear()}/{(completionDate.getMonth()+1).toString().padStart(2,'0')}/{completionDate.getDate().toString().padStart(2,'0')}
                                    </div>
                                    <div className="text-white font-bold">
                                        {completionDate.getHours().toString().padStart(2,'0')}:{completionDate.getMinutes().toString().padStart(2,'0')}:{completionDate.getSeconds().toString().padStart(2,'0')}
                                    </div>
                                </div>
                                <div className="glass-effect rounded-2xl p-6 text-center">
                                    <div className="text-4xl mb-2">â±ï¸</div>
                                    <div className="text-white/80 text-sm mb-1">ç¸½é—–é—œæ™‚é–“</div>
                                    <div className="text-3xl font-bold text-white">
                                        {Math.floor(sectionTotalTime / 60)}:{(sectionTotalTime % 60).toString().padStart(2, '0')}
                                    </div>
                                </div>
                                <div className="glass-effect rounded-2xl p-6 text-center">
                                    <div className="text-4xl mb-2">ğŸ¯</div>
                                    <div className="text-white/80 text-sm mb-1">ç¸½å˜—è©¦æ¬¡æ•¸</div>
                                    <div className="text-3xl font-bold text-white">{totalAttempts}</div>
                                </div>
                                <div className="glass-effect rounded-2xl p-6 text-center">
                                    <div className="text-4xl mb-2">{wrongAttempts === 0 ? 'ğŸ’¯' : 'ğŸ“Š'}</div>
                                    <div className="text-white/80 text-sm mb-1">éŒ¯èª¤æ¬¡æ•¸</div>
                                    <div className={`text-3xl font-bold ${wrongAttempts === 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        {wrongAttempts}
                                    </div>
                                </div>
                            </div>

                            {/* é—œå¡è©³æƒ… */}
                            <div className="glass-effect rounded-2xl p-6 mb-6">
                                <h3 className="text-2xl font-bold text-white mb-4 flex items-center">
                                    <i className="fas fa-list-check mr-3"></i>
                                    é—œå¡å®Œæˆè©³æƒ…
                                </h3>
                                <div className="space-y-3">
                                    {completedLevels.map((level, idx) => (
                                        <div key={idx} className="bg-white/10 rounded-xl p-4 flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold">
                                                    âœ“
                                                </div>
                                                <div>
                                                    <div className="text-white font-bold">{level.title}</div>
                                                    <div className="text-white/70 text-sm">å˜—è©¦æ¬¡æ•¸ï¼š{level.attempts} æ¬¡</div>
                                                </div>
                                            </div>
                                            <div className="text-white/80">
                                                {Math.floor(level.time / 60)}:{(level.time % 60).toString().padStart(2, '0')}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* éŒ¯èª¤è¨˜éŒ„ */}
                            {errorLog.length > 0 && (
                                <div className="glass-effect rounded-2xl p-6 mb-6">
                                    <h3 className="text-2xl font-bold text-white mb-4 flex items-center">
                                        <i className="fas fa-exclamation-triangle mr-3 text-yellow-400"></i>
                                        éŒ¯èª¤è¨˜éŒ„èˆ‡æ­£ç¢ºç­”æ¡ˆ
                                    </h3>
                                    <div className="space-y-4">
                                        {errorLog.map((log, idx) => (
                                            <div key={idx} className="bg-white/10 rounded-xl p-4">
                                                <div className="text-white font-bold mb-2 flex items-center gap-2">
                                                    <span className="bg-red-500 px-2 py-1 rounded text-xs">éŒ¯èª¤ {idx + 1}</span>
                                                    {log.levelTitle}
                                                </div>
                                                {log.errors.map((error, errorIdx) => (
                                                    <div key={errorIdx} className="ml-4 mb-2 bg-white/5 rounded-lg p-3">
                                                        <div className="text-white/80 text-sm mb-1">
                                                            ğŸ“ {error.zone}
                                                        </div>
                                                        <div className="grid md:grid-cols-2 gap-2 text-sm">
                                                            <div>
                                                                <span className="text-red-400">âŒ ä½ çš„ç­”æ¡ˆï¼š</span>
                                                                <span className="text-white ml-2">
                                                                    {error.userAnswer.length > 0 ? error.userAnswer.join(', ') : '(æœªå¡«å¯«)'}
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <span className="text-green-400">âœ“ æ­£ç¢ºç­”æ¡ˆï¼š</span>
                                                                <span className="text-white ml-2">
                                                                    {error.correctAnswer.join(', ')}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* æˆå°±è©•ç´š */}
                            <div className="glass-effect rounded-2xl p-6 mb-6 text-center">
                                <h3 className="text-2xl font-bold text-white mb-4">ğŸŒŸ æˆå°±è©•ç´š</h3>
                                <div className="text-6xl mb-2">
                                    {wrongAttempts === 0 ? 'ğŸ†' : wrongAttempts <= 2 ? 'ğŸ¥‡' : wrongAttempts <= 5 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}
                                </div>
                                <div className="text-2xl font-bold text-white mb-2">
                                    {wrongAttempts === 0 ? 'å®Œç¾é€šé—œï¼' : wrongAttempts <= 2 ? 'å„ªç§€è¡¨ç¾ï¼' : wrongAttempts <= 5 ? 'è¡¨ç¾è‰¯å¥½ï¼' : 'ç¹¼çºŒåŠ æ²¹ï¼'}
                                </div>
                                <div className="text-white/80">
                                    {wrongAttempts === 0 ? 'ä¸€æ¬¡éŒ¯èª¤éƒ½æ²’æœ‰ï¼Œå¤ªå²å®³äº†ï¼' : 
                                     wrongAttempts <= 2 ? 'åªæœ‰å°‘æ•¸éŒ¯èª¤ï¼Œéå¸¸æ£’ï¼' :
                                     wrongAttempts <= 5 ? 'é‚„æœ‰é€²æ­¥ç©ºé–“ï¼ŒåŠ æ²¹ï¼' :
                                     'å¤šç·´ç¿’å¹¾æ¬¡æœƒæ›´å¥½çš„ï¼'}
                                </div>
                            </div>
                        </div>

                        {/* æ“ä½œæŒ‰éˆ• */}
                        <div className="max-w-5xl mx-auto flex gap-4 justify-center mt-6 flex-wrap">
                            <button
                                onClick={takeScreenshot}
                                className="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:scale-105 transition-all shadow-xl"
                            >
                                <i className="fas fa-camera mr-2"></i>
                                ä¸‹è¼‰å­¸ç¿’æˆæœæˆªåœ–
                            </button>
                            <button
                                onClick={() => {
                                    setCurrentLevelIndex(0);
                                    setScreen('playing');
                                    setGameState('playing');
                                    setStartTime(new Date());
                                    setSectionStartTime(new Date());
                                    setElapsedTime(0);
                                    setDroppedItems({});
                                    setFormulaSlots({ left: null, right1: null, right2: null, right3: null });
                                    setMatchZones({});
                                    setFeedback({});
                                    setScore({ correct: 0, total: 0 });
                                    setErrorLog([]);
                                    setCompletedLevels([]);
                                    initializeLevel(currentSection, 0);
                                }}
                                className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:scale-105 transition-all shadow-xl"
                            >
                                <i className="fas fa-redo mr-2"></i>
                                å†æŒ‘æˆ°ä¸€æ¬¡
                            </button>
                            <button
                                onClick={() => setScreen('section_select')}
                                className="bg-white/20 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/30 transition-all"
                            >
                                <i className="fas fa-home mr-2"></i>
                                è¿”å›é¸å–®
                            </button>
                        </div>
                    </div>
                );
            }

            // ===========================================
            // å°ç¯€å®Œæˆç•«é¢
            // ===========================================
            if (screen === 'section_complete') {
                const accuracy = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
                
                return (
                    <div className="min-h-screen flex items-center justify-center p-6">
                        <div className="max-w-2xl w-full glass-effect rounded-3xl p-12 text-center fade-in">
                            <div className="text-8xl mb-6">ğŸ‰</div>
                            <h2 className="text-5xl font-black text-white mb-4">
                                æ­å–œå®Œæˆï¼
                            </h2>
                            <p className="text-2xl text-white/90 mb-8">
                                ä½ å·²å®Œæˆ {currentSection} æ‰€æœ‰é—œå¡
                            </p>
                            
                            <div className="grid grid-cols-3 gap-6 mb-8">
                                <div className="bg-white/10 rounded-2xl p-6">
                                    <div className="text-4xl font-bold text-white mb-2">{score.correct}</div>
                                    <div className="text-white/80">æ­£ç¢ºæ¬¡æ•¸</div>
                                </div>
                                <div className="bg-white/10 rounded-2xl p-6">
                                    <div className="text-4xl font-bold text-white mb-2">{score.total}</div>
                                    <div className="text-white/80">ç¸½å˜—è©¦æ¬¡æ•¸</div>
                                </div>
                                <div className="bg-white/10 rounded-2xl p-6">
                                    <div className="text-4xl font-bold text-white mb-2">{accuracy}%</div>
                                    <div className="text-white/80">æ­£ç¢ºç‡</div>
                                </div>
                            </div>

                            <div className="flex gap-4 justify-center">
                                <button
                                    onClick={() => {
                                        setCurrentLevelIndex(0);
                                        setScreen('playing');
                                        setGameState('playing');
                                        setStartTime(new Date());
                                        setElapsedTime(0);
                                        setDroppedItems({});
                                        setFormulaSlots({ left: null, right1: null, right2: null, right3: null });
                                        setFeedback({});
                                        setScore({ correct: 0, total: 0 });
                                    }}
                                    className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:scale-105 transition-all shadow-xl"
                                >
                                    <i className="fas fa-redo mr-2"></i>
                                    å†ç©ä¸€æ¬¡
                                </button>
                                <button
                                    onClick={() => setScreen('section_select')}
                                    className="bg-white/20 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/30 transition-all"
                                >
                                    <i className="fas fa-home mr-2"></i>
                                    è¿”å›é¸å–®
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        // æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
